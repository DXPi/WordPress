!function(i){i.ui.WPLinkPreview=i.ui.Control.extend({url:"#",renderHtml:function(){return'<div id="'+this._id+'" class="wp-link-preview"><a href="'+this.url+'" target="_blank" rel="noopener" tabindex="-1">'+this.url+"</a></div>"},setURL:function(e){var n,t;this.url!==e&&(this.url=e,40<(e="/"===(e=(e=-1!==(n=(e=-1!==(n=(e=(e=window.decodeURIComponent(e)).replace(/^(?:https?:)?\/\/(?:www\.)?/,"")).indexOf("?"))?e.slice(0,n):e).indexOf("#"))?e.slice(0,n):e).replace(/(?:index)?\.html$/,"")).charAt(e.length-1)?e.slice(0,-1):e).length&&-1!==(n=e.indexOf("/"))&&-1!==(t=e.lastIndexOf("/"))&&t!==n&&(n+e.length-t<40&&(t=-(40-(n+1))),e=e.slice(0,n+1)+"\u2026"+e.slice(t)),i.$(this.getEl().firstChild).attr("href",this.url).text(e))}}),i.PluginManager.add("wplink",function(d){var l;d.addCommand("WP_Link",function(){window.wpLink&&window.wpLink.open(d.id)}),d.addShortcut("Alt+Shift+A","","WP_Link"),d.addShortcut("Meta+K","","WP_Link"),d.addButton("link",{icon:"link",tooltip:"Insert/edit link",cmd:"WP_Link",stateSelector:"a[href]"}),d.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink"}),d.addMenuItem("link",{icon:"link",text:"Insert/edit link",cmd:"WP_Link",stateSelector:"a[href]",context:"insert",prependToContext:!0}),d.on("pastepreprocess",function(e){var n=e.content,t=/^(?:https?:)?\/\/\S+$/i;d.selection.isCollapsed()||t.test(d.selection.getContent())||(n=n.replace(/<[^>]+>/g,""),n=i.trim(n),t.test(n)&&(d.execCommand("mceInsertLink",!1,{href:d.dom.decode(n)}),e.preventDefault()))}),d.addButton("wp_link_preview",{type:"WPLinkPreview",onPostRender:function(){var o=this;d.on("wptoolbar",function(e){var n,t,i=d.dom.getParent(e.element,"a");i&&(t=(n=d.$(i)).attr("href"))&&!n.find("img").length&&(o.setURL(t),e.element=i,e.toolbar=l)})}}),d.addButton("wp_link_edit",{tooltip:"Edit ",icon:"dashicon dashicons-edit",cmd:"WP_Link"}),d.addButton("wp_link_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",cmd:"unlink"}),d.on("preinit",function(){d.wp&&d.wp._createToolbar&&(l=d.wp._createToolbar(["wp_link_preview","wp_link_edit","wp_link_remove"],!0))})})}(window.tinymce);