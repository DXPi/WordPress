!function(y,C){y.Env.ie&&y.Env.ie<9||y.PluginManager.add("wptextpattern",function(l){var f,u=y.util.VK,g=[{regExp:/^[*-]\s/,cmd:"InsertUnorderedList"},{regExp:/^1[.)]\s/,cmd:"InsertOrderedList"}],d=[{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:">",format:"blockquote"},{regExp:/^(-){3,}$/,element:"hr"}],p=[{start:"`",end:"`",format:"code"}],m=[];function h(e){var t,n=l.dom.getParent(e,"p");if(n){for(;(t=n.firstChild)&&3!==t.nodeType;)n=t;if(t)return t=!t.data?t.nextSibling&&3===t.nextSibling.nodeType?t.nextSibling:null:t}}y.each(p,function(e){y.each((e.start+e.end).split(""),function(e){-1===y.inArray(m,e)&&m.push(e)})}),l.on("selectionchange",function(){f=null}),l.on("keydown",function(e){(f&&27===e.keyCode||"space"===f&&e.keyCode===u.BACKSPACE)&&(l.undoManager.undo(),e.preventDefault(),e.stopImmediatePropagation()),e.keyCode!==u.ENTER||u.modifierPressed(e)||function(){var e,t,n,a=l.selection.getRng().startContainer,r=h(a),o=d.length;if(r){for(e=r.data;o--;)if(d[o].start){if(0===e.indexOf(d[o].start)){t=d[o];break}}else if(d[o].regExp&&d[o].regExp.test(e)){t=d[o];break}t&&(r===a&&y.trim(e)===t.start||l.once("keyup",function(){l.undoManager.add(),l.undoManager.transact(function(){var e;t.format?(l.formatter.apply(t.format,{},r),r.replaceData(0,r.data.length,(e=r.data.slice(t.start.length))?e.replace(/^\s+/,""):"")):t.element&&(n=r.parentNode&&r.parentNode.parentNode)&&n.replaceChild(document.createElement(t.element),r.parentNode)}),C(function(){f="enter"})}))}}()},!0),l.on("keyup",function(e){var t,a,n,r,o,d,i,s,c;e.keyCode!==u.SPACEBAR||e.ctrlKey||e.metaKey||e.altKey?47<e.keyCode&&!(91<=e.keyCode&&e.keyCode<=93)&&(e=l.selection.getRng(),r=e.startContainer,o=e.startOffset,r&&3===r.nodeType&&r.data.length&&o&&-1!==y.inArray(m,r.data.charAt(o-1))&&(t=function(e){for(var t,n=p.length;n--;)if(a=p[n],-1!==(t=e.data.indexOf(a.end)))return t}(r),e=r.data.lastIndexOf(a.end),t!==e&&-1!==e&&(e-t<=a.start.length||-1===r.data.slice(t+a.start.length,e).indexOf(a.start.slice(0,1))&&(e=l.formatter.get(a.format))&&e[0].inline&&(l.undoManager.add(),l.undoManager.transact(function(){r.insertData(o,"\u200b"),r=r.splitText(t),n=r.splitText(o-t),r.deleteData(0,a.start.length),r.deleteData(r.data.length-a.end.length,a.end.length),l.formatter.apply(a.format,{},r),l.selection.setCursorLocation(n,1)}),C(function(){f="space",l.once("selectionchange",function(){var e;n&&-1!==(e=n.data.indexOf("\u200b"))&&n.deleteData(e,e+1)})}))))):(s=l.selection.getRng(),(c=s.startContainer)&&h(c)===c&&(d=c.parentNode,i=c.data,y.each(g,function(e){var t=i.match(e.regExp);if(t&&s.startOffset===t[0].length)return l.undoManager.add(),l.undoManager.transact(function(){c.deleteData(0,t[0].length),d.innerHTML||d.appendChild(document.createElement("br")),l.selection.setCursorLocation(d),l.execCommand(e.cmd)}),C(function(){f="space"}),!1})))})})}(window.tinymce,window.setTimeout);