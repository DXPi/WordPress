!function(u,m){u.PluginManager.add("wptextpattern",function(i){var d,s,c,e=u.util.VK,f=[{regExp:/^[*-]\s/,cmd:"InsertUnorderedList"},{regExp:/^1[.)]\s/,cmd:"InsertOrderedList"}],o=[{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:">",format:"blockquote"}];function l(t){var e,n=i.dom.getParent(t,"p");if(n){for(;(e=n.firstChild)&&3!==e.nodeType;)n=e;if(e)return e=!e.data?e.nextSibling&&3===e.nextSibling.nodeType?e.nextSibling:null:e}}i.on("selectionchange",function(){d=null}),i.on("keydown",function(t){(d&&27===t.keyCode||"space"===d&&t.keyCode===e.BACKSPACE)&&(i.undoManager.undo(),t.preventDefault(),t.stopImmediatePropagation()),t.keyCode!==e.ENTER||e.modifierPressed(t)||function(){var t,e,n=i.selection.getRng().startContainer,a=l(n),r=o.length;if(a){for(t=a.data;r--;)if(0===t.indexOf(o[r].start)){e=o[r];break}e&&(a===n&&u.trim(t)===e.start||(s=a,c=e))}}()},!0),i.on("keyup",function(t){var n,a,r,o;t.keyCode!==e.SPACEBAR||t.ctrlKey||t.metaKey||t.altKey?t.keyCode!==e.ENTER||e.modifierPressed(t)||(s&&(i.undoManager.add(),i.undoManager.transact(function(){i.formatter.apply(c.format,{},s),s.replaceData(0,s.data.length,u.trim(s.data.slice(c.start.length)))}),m(function(){d="enter"})),c=s=null):(r=i.selection.getRng(),(o=r.startContainer)&&l(o)===o&&(n=o.parentNode,a=o.data,u.each(f,function(t){var e=a.match(t.regExp);if(e&&r.startOffset===e[0].length)return i.undoManager.add(),i.undoManager.transact(function(){o.deleteData(0,e[0].length),n.innerHTML||n.appendChild(document.createElement("br")),i.selection.setCursorLocation(n),i.execCommand(t.cmd)}),m(function(){d="space"}),!1})))})})}(window.tinymce,window.setTimeout);