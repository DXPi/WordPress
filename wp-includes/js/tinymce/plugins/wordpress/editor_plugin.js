!function(){var a=tinymce.DOM;tinymce.create("tinymce.plugins.WordPress",{init:function(n,e){var m,d=this,o=n.getParam("wordpress_adv_toolbar","toolbar2"),s=0,t='<img src="'+e+'/img/trans.gif" class="mce-wp-more mceItemNoResize" title="'+n.getLang("wordpress.wp_more_alt")+'" />',i='<img src="'+e+'/img/trans.gif" class="mce-wp-nextpage mceItemNoResize" title="'+n.getLang("wordpress.wp_page_alt")+'" />';"1"==getUserSetting("hidetb","0")&&(n.settings.wordpress_adv_hidden=0),n.onPostRender.add(function(){var e=n.controlManager.get(o);n.getParam("wordpress_adv_hidden",1)&&e&&(a.hide(e.id),d._resizeIframe(n,o,28))}),n.addCommand("WP_More",function(){n.execCommand("mceInsertContent",0,t)}),n.addCommand("WP_Page",function(){n.execCommand("mceInsertContent",0,i)}),n.addCommand("WP_Help",function(){n.windowManager.open({url:tinymce.baseURL+"/wp-mce-help.php",width:450,height:420,inline:1})}),n.addCommand("WP_Adv",function(){var e=n.controlManager,t=e.get(o).id;"undefined"!=t&&(a.isHidden(t)?(e.setActive("wp_adv",1),a.show(t),d._resizeIframe(n,o,-28),n.settings.wordpress_adv_hidden=0,setUserSetting("hidetb","1")):(e.setActive("wp_adv",0),a.hide(t),d._resizeIframe(n,o,28),n.settings.wordpress_adv_hidden=1,setUserSetting("hidetb","0")))}),n.addCommand("WP_Medialib",function(){"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(n.id)}),n.addButton("wp_more",{title:"wordpress.wp_more_desc",cmd:"WP_More"}),n.addButton("wp_page",{title:"wordpress.wp_page_desc",image:e+"/img/page.gif",cmd:"WP_Page"}),n.addButton("wp_help",{title:"wordpress.wp_help_desc",cmd:"WP_Help"}),n.addButton("wp_adv",{title:"wordpress.wp_adv_desc",cmd:"WP_Adv"}),n.addButton("add_media",{title:"wordpress.add_media",image:e+"/img/image.gif",cmd:"WP_Medialib"}),n.onBeforeExecCommand.add(function(e,t,n,d,o){var s,i,a,r,c=tinymce.DOM;"mceFullScreen"==t&&"mce_fullscreen"!=e.id&&c.select("a.thickbox").length&&(e.settings.theme_advanced_buttons1+=",|,add_media"),"JustifyLeft"!=t&&"JustifyRight"!=t&&"JustifyCenter"!=t||"IMG"==(s=e.selection.getNode()).nodeName&&(r="align"+t.substr(7).toLowerCase(),i=e.dom.getParent(s,"dl.wp-caption"),a=e.dom.getParent(s,"div.mceTemp"),i&&a?(c=e.dom.hasClass(i,r)?"alignnone":r,i.className=i.className.replace(/align[^ '"]+\s?/g,""),e.dom.addClass(i,c),"aligncenter"==c?e.dom.addClass(a,"mceIEcenter"):e.dom.removeClass(a,"mceIEcenter"),o.terminate=!0,e.execCommand("mceRepaint")):e.dom.hasClass(s,r)?e.dom.addClass(s,"alignnone"):e.dom.removeClass(s,"alignnone")),!tinymce.isWebKit||"InsertUnorderedList"!=t&&"InsertOrderedList"!=t||(m=m||e.dom.create("style",{type:"text/css"},"#tinymce,#tinymce span,#tinymce li,#tinymce li>span,#tinymce p,#tinymce p>span{font:medium sans-serif;color:#000;line-height:normal;}"),e.getDoc().head.appendChild(m))}),n.onExecCommand.add(function(e,t,n,d){tinymce.isWebKit&&m&&("InsertUnorderedList"==t||"InsertOrderedList"==t)&&e.dom.remove(m)}),n.onInit.add(function(t){var e=t.getParam("body_class",""),n=t.getBody(),e=e?e.split(" "):[];"rtl"==t.getParam("directionality","")&&e.push("rtl"),tinymce.isIE9?e.push("ie9"):tinymce.isIE8?e.push("ie8"):tinymce.isIE7&&e.push("ie7"),"wp_mce_fullscreen"!=t.id&&"mce_fullscreen"!=t.id?e.push("wp-editor"):"mce_fullscreen"==t.id&&e.push("mce-fullscreen"),tinymce.each(e,function(e){e&&t.dom.addClass(n,e)}),t.onNodeChange.add(function(e,t,n){var d;"IMG"==n.nodeName?d=e.dom.getParent(n,"dl.wp-caption"):"DIV"==n.nodeName&&e.dom.hasClass(n,"mceTemp")&&(d=n.firstChild,e.dom.hasClass(d,"wp-caption")||(d=!1)),d&&(e.dom.hasClass(d,"alignleft")?t.setActive("justifyleft",1):e.dom.hasClass(d,"alignright")?t.setActive("justifyright",1):e.dom.hasClass(d,"aligncenter")&&t.setActive("justifycenter",1))}),t.onBeforeSetContent.add(function(e,t){t.content&&(t.content=t.content.replace(/<p>\s*<(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)( [^>]*)?>/gi,"<$1$2>"),t.content=t.content.replace(/<\/(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)>\s*<\/p>/gi,"</$1>"))})}),"undefined"!=typeof jQuery&&n.onKeyUp.add(function(e,t){t=t.keyCode||t.charCode;t!=s&&(13!=t&&8!=s&&46!=s||jQuery(document).triggerHandler("wpcountwords",[e.getContent({format:"raw"})]),s=t)}),n.onSaveContent.addToTop(function(e,t){t.content=t.content.replace(/<p>(<br ?\/?>|\u00a0|\uFEFF)?<\/p>/g,"<p>&nbsp;</p>")}),tinymce.isIOS5&&n.onKeyDown.add(function(){document.activeElement==document.body&&n.getWin().focus()}),n.onSaveContent.add(function(e,t){e.isHidden()?t.content=t.element.value:e.getParam("wpautop",!0)&&"object"==typeof switchEditors&&(t.content=switchEditors.pre_wpautop(t.content))}),d._handleMoreBreak(n,e),e="alt+shift",n.addShortcut(e+"+c","justifycenter_desc","JustifyCenter"),n.addShortcut(e+"+r","justifyright_desc","JustifyRight"),n.addShortcut(e+"+l","justifyleft_desc","JustifyLeft"),n.addShortcut(e+"+j","justifyfull_desc","JustifyFull"),n.addShortcut(e+"+q","blockquote_desc","mceBlockQuote"),n.addShortcut(e+"+u","bullist_desc","InsertUnorderedList"),n.addShortcut(e+"+o","numlist_desc","InsertOrderedList"),n.addShortcut(e+"+n","spellchecker.desc","mceSpellCheck"),n.addShortcut(e+"+a","link_desc","WP_Link"),n.addShortcut(e+"+s","unlink_desc","unlink"),n.addShortcut(e+"+m","image_desc","WP_Medialib"),n.addShortcut(e+"+z","wordpress.wp_adv_desc","WP_Adv"),n.addShortcut(e+"+t","wordpress.wp_more_desc","WP_More"),n.addShortcut(e+"+d","striketrough_desc","Strikethrough"),n.addShortcut(e+"+h","help_desc","WP_Help"),n.addShortcut(e+"+p","wordpress.wp_page_desc","WP_Page"),n.addShortcut("ctrl+s","save_desc",function(){"function"==typeof autosave&&autosave()}),/\bwpfullscreen\b/.test(n.settings.plugins)?n.addShortcut(e+"+w","wordpress.wp_fullscreen_desc","wpFullScreen"):/\bfullscreen\b/.test(n.settings.plugins)&&n.addShortcut(e+"+g","fullscreen.desc","mceFullScreen"),n.onInit.add(function(t){tinymce.dom.Event.add(t.getWin(),"scroll",function(e){t.plugins.wordpress._hideButtons()}),tinymce.dom.Event.add(t.getBody(),"dragstart",function(e){t.plugins.wordpress._hideButtons()})}),n.onBeforeExecCommand.add(function(e,t,n,d){e.plugins.wordpress._hideButtons()}),n.onSaveContent.add(function(e,t){e.plugins.wordpress._hideButtons()}),n.onMouseDown.add(function(e,t){"IMG"!=t.target.nodeName&&e.plugins.wordpress._hideButtons()}),n.onKeyDown.add(function(e,t){t.which!=tinymce.VK.DELETE&&t.which!=tinymce.VK.BACKSPACE||e.plugins.wordpress._hideButtons()}),e=function(e){if("mceModalBlocker"==e.target.id||"ui-widget-overlay"==e.target.className)for(var t in n.windowManager.windows)n.windowManager.close(null,t)},tinymce.dom.Event.remove(document.body,"click",e),tinymce.dom.Event.add(document.body,"click",e)},getInfo:function(){return{longname:"WordPress Plugin",author:"WordPress",authorurl:"http://wordpress.org",infourl:"http://wordpress.org",version:"3.0"}},_setEmbed:function(e){return e.replace(/\[embed\]([\s\S]+?)\[\/embed\][\s\u00a0]*/g,function(e,t){return'<img width="300" height="200" src="'+tinymce.baseURL+'/plugins/wordpress/img/trans.gif" class="wp-oembed mceItemNoResize" alt="'+t+'" title="'+t+'" />'})},_getEmbed:function(e){return e.replace(/<img[^>]+>/g,function(e){var t;return-1==e.indexOf('class="wp-oembed')||(t=e.match(/alt="([^\"]+)"/))[1]&&(e="[embed]"+t[1]+"[/embed]"),e})},_showButtons:function(e,t){var n=tinyMCE.activeEditor,d=tinymce.DOM,o=n.dom.getViewPort(n.getWin()),s=d.getPos(n.getContentAreaContainer()),n=n.dom.getPos(e),e=Math.max(n.x-o.x,0)+s.x,s=Math.max(n.y-o.y,0)+s.y;d.setStyles(t,{top:s+5+"px",left:e+5+"px",display:"block"})},_hideButtons:function(){var e=tinymce.DOM;e.hide(e.select("#wp_editbtns, #wp_gallerybtns"))},_resizeIframe:function(e,t,n){var d=e.getContentAreaContainer().firstChild;a.setStyle(d,"height",d.clientHeight+n),e.theme.deltaHeight+=n},_handleMoreBreak:function(n,e){var d='<img src="'+e+'/img/trans.gif" alt="$1" class="mce-wp-more mceItemNoResize" title="'+n.getLang("wordpress.wp_more_alt")+'" />',o='<img src="'+e+'/img/trans.gif" class="mce-wp-nextpage mceItemNoResize" title="'+n.getLang("wordpress.wp_page_alt")+'" />';n.onPostRender.add(function(){n.theme.onResolveName&&n.theme.onResolveName.add(function(e,t){"IMG"==t.node.nodeName&&(n.dom.hasClass(t.node,"mce-wp-more")&&(t.name="wpmore"),n.dom.hasClass(t.node,"mce-wp-nextpage")&&(t.name="wppage"))})}),n.onBeforeSetContent.add(function(e,t){t.content&&(t.content=t.content.replace(/<!--more(.*?)-->/g,d),t.content=t.content.replace(/<!--nextpage-->/g,o))}),n.onPostProcess.add(function(e,t){t.get&&(t.content=t.content.replace(/<img[^>]+>/g,function(e){var t;return e=-1!==(e=-1!==e.indexOf('class="mce-wp-more')?"\x3c!--more"+((t=e.match(/alt="(.*?)"/))?t[1]:"")+"--\x3e":e).indexOf('class="mce-wp-nextpage')?"\x3c!--nextpage--\x3e":e}))}),n.onNodeChange.add(function(e,t,n){t.setActive("wp_page","IMG"===n.nodeName&&e.dom.hasClass(n,"mce-wp-nextpage")),t.setActive("wp_more","IMG"===n.nodeName&&e.dom.hasClass(n,"mce-wp-more"))})}}),tinymce.PluginManager.add("wordpress",tinymce.plugins.WordPress)}();