!function(d){var t=wp.customize,o=function(n,i,t){var o;return function(){var e=arguments;t=t||this,clearTimeout(o),o=setTimeout(function(){o=null,n.apply(t,e)},i)}};t.Preview=t.Messenger.extend({initialize:function(e,n){var i=this;t.Messenger.prototype.initialize.call(this,e,n),this.body=d(document.body),this.body.on("click.preview","a",function(e){e.preventDefault(),i.send("scroll",0),i.send("url",d(this).prop("href"))}),this.body.on("submit.preview","form",function(e){e.preventDefault()}),this.window=d(window),this.window.on("scroll.preview",o(function(){i.send("scroll",i.window.scrollTop())},200)),this.bind("scroll",function(e){i.window.scrollTop(e)})}}),d(function(){var e;t.settings=window._wpCustomizeSettings,t.settings&&(t.preview=new t.Preview({url:window.location.href,channel:t.settings.channel}),t.preview.bind("settings",function(e){d.each(e,function(e,n){t.has(e)?t(e).set(n):t.create(e,n)})}),t.preview.trigger("settings",t.settings.values),t.preview.bind("setting",function(e){var n;e=e.slice(),(n=t(e.shift()))&&n.set.apply(n,e)}),t.preview.bind("sync",function(e){d.each(e,function(e,n){t.preview.trigger(e,n)}),t.preview.send("synced")}),t.preview.bind("active",function(){t.settings.nonce&&t.preview.send("nonce",t.settings.nonce),t.preview.send("documentTitle",document.title)}),t.preview.send("ready",{activePanels:t.settings.activePanels,activeSections:t.settings.activeSections,activeControls:t.settings.activeControls}),t.preview.bind("loading-initiated",function(){d("body").addClass("wp-customizer-unloading")}),t.preview.bind("loading-failed",function(){d("body").removeClass("wp-customizer-unloading")}),e=d.map(["color","image","position_x","repeat","attachment"],function(e){return"background_"+e}),t.when.apply(t,e).done(function(n,i,t,o,s){var c=d(document.body),r=d("head"),a=d("#custom-background-css"),e=function(){var e="";c.toggleClass("custom-background",!(!n()&&!i())),n()&&(e+="background-color: "+n()+";"),i()&&(e+='background-image: url("'+i()+'");',e+="background-position: top "+t()+";",e+="background-repeat: "+o()+";",e+="background-attachment: "+s()+";"),a.remove(),a=d('<style type="text/css" id="custom-background-css">body.custom-background { '+e+" }</style>").appendTo(r)};d.each(arguments,function(){this.bind(e)})}),t.trigger("preview-ready"))})}((wp,jQuery));