!function(L,N){"use strict";var V=N(L),j=N(document),I=N("#wpadminbar"),M=N("#wpfooter");N(function(){var p,e,u=N("#postdivrich"),h=N("#wp-content-wrap"),m=N("#wp-content-editor-tools"),w=N(),H=N(),b=N("#ed_toolbar"),v=N("#content"),x=N('<div id="content-textarea-clone"></div>'),y=N("#post-status-info"),C=N(),T=N(),B=N("#side-sortables"),S=N("#postbox-container-1"),O=N("#post-body"),z=L.wp.editor&&L.wp.editor.fullscreen,r=function(){},l=function(){},E=!1,k=!1,A=!1,R=!1,W=0,Y=56,K=20,U=300,o=h.hasClass("tmce-active")?"tinymce":"html",P=!!parseInt(L.getUserSetting("hidetb"),10),D={windowHeight:0,windowWidth:0,adminBarHeight:0,toolsHeight:0,menuBarHeight:0,visualTopHeight:0,textTopHeight:0,bottomHeight:0,statusBarHeight:0,sideSortablesHeight:0};function t(t){var e,o,i,n=jQuery.ui.keyCode,s=t.keyCode,f=document.createRange(),a=v[0].selectionStart,d=v[0].selectionEnd,c=x[0].firstChild;if(!a||!d||a===d){try{f.setStart(c,a),f.setEnd(c,d+1)}catch(t){}(i=f.getBoundingClientRect()).height&&(o=(e=i.top-10)+i.height+10,t=D.adminBarHeight+D.toolsHeight+D.textTopHeight,i=D.windowHeight-D.bottomHeight,e<t&&(s===n.UP||s===n.LEFT||s===n.BACKSPACE)?L.scrollTo(L.pageXOffset,e+L.pageYOffset-t):i<o&&L.scrollTo(L.pageXOffset,o+L.pageYOffset-i))}}function X(){var t,e;p&&!p.isHidden()||!p&&"tinymce"===o||(t=v.height(),x.width(v.width()-22),x.text(v.val()+"&nbsp;"),(e=(e=x.height())<U?U:e)!==t&&(v.height(e),g()))}function g(t){var e,o,i,n,s,f,a,d,c,u,r,l,g;z&&z.settings.visible||(e=V.scrollTop(),o="scroll"!==(r=t&&t.type),i=p&&!p.isHidden(),n=U,s=O.offset().top,f=h.width(),!o&&D.windowHeight||(g=V.width(),(D={windowHeight:V.height(),windowWidth:g,adminBarHeight:600<g?I.outerHeight():0,toolsHeight:m.outerHeight()||0,menuBarHeight:C.outerHeight()||0,visualTopHeight:w.outerHeight()||0,textTopHeight:b.outerHeight()||0,bottomHeight:y.outerHeight()||0,statusBarHeight:T.outerHeight()||0,sideSortablesHeight:B.height()||0}).menuBarHeight<3&&(D.menuBarHeight=0)),i||"resize"!==r||X(),u=i?(a=w,l=H,D.visualTopHeight):(a=b,l=v,D.textTopHeight),g=a.parent().offset().top,r=l.offset().top,l=l.outerHeight(),(i?U+u:U+20)+5<l?((!E||o)&&e>=g-D.toolsHeight-D.adminBarHeight&&e<=g-D.toolsHeight-D.adminBarHeight+l-n?(E=!0,m.css({position:"fixed",top:D.adminBarHeight,width:f}),i&&C.length&&C.css({position:"fixed",top:D.adminBarHeight+D.toolsHeight,width:f-2-(i?0:a.outerWidth()-a.width())}),a.css({position:"fixed",top:D.adminBarHeight+D.toolsHeight+D.menuBarHeight,width:f-2-(i?0:a.outerWidth()-a.width())})):(E||o)&&(e<=g-D.toolsHeight-D.adminBarHeight?(E=!1,m.css({position:"absolute",top:0,width:f}),i&&C.length&&C.css({position:"absolute",top:0,width:f-2}),a.css({position:"absolute",top:D.menuBarHeight,width:f-2-(i?0:a.outerWidth()-a.width())})):e>=g-D.toolsHeight-D.adminBarHeight+l-n&&(E=!1,m.css({position:"absolute",top:l-n,width:f}),i&&C.length&&C.css({position:"absolute",top:l-n,width:f-2}),a.css({position:"absolute",top:l-n+D.menuBarHeight,width:f-2-(i?0:a.outerWidth()-a.width())}))),(!k||o&&P)&&e+D.windowHeight<=r+l+D.bottomHeight+D.statusBarHeight+1?t&&0<t.deltaHeight&&t.deltaHeight<100?L.scrollBy(0,t.deltaHeight):P&&(k=!0,T.css({position:"fixed",bottom:D.bottomHeight,visibility:"",width:f-2}),y.css({position:"fixed",bottom:0,width:f})):(!P&&k||(k||o)&&e+D.windowHeight>r+l+D.bottomHeight+D.statusBarHeight-1)&&(k=!1,T.add(y).attr("style",""),P||T.css("visibility","hidden"))):o&&(m.css({position:"absolute",top:0,width:f}),i&&C.length&&C.css({position:"absolute",top:0,width:f-2}),a.css({position:"absolute",top:D.menuBarHeight,width:f-2-(i?0:a.outerWidth()-a.width())}),T.add(y).attr("style","")),S.width()<300&&600<D.windowWidth&&j.height()>B.height()+s+120&&D.windowHeight<l?(D.sideSortablesHeight+Y+K>D.windowHeight||A||R?e+Y<=s?(B.attr("style",""),A=R=!1):W<e?A?(A=!1,d=B.offset().top-D.adminBarHeight,(c=M.offset().top)<d+D.sideSortablesHeight+K&&(d=c-D.sideSortablesHeight-12),B.css({position:"absolute",top:d,bottom:""})):!R&&D.sideSortablesHeight+B.offset().top+K<e+D.windowHeight&&(R=!0,B.css({position:"fixed",top:"auto",bottom:K})):e<W&&(R?(R=!1,d=B.offset().top-K,(c=M.offset().top)<d+D.sideSortablesHeight+K&&(d=c-D.sideSortablesHeight-12),B.css({position:"absolute",top:d,bottom:""})):!A&&B.offset().top>=e+Y&&(A=!0,B.css({position:"fixed",top:Y,bottom:""}))):(s-Y<=e?B.css({position:"fixed",top:Y}):B.attr("style",""),A=R=!1),W=e):(B.attr("style",""),A=R=!1),o&&(h.css({paddingTop:D.toolsHeight}),i?H.css({paddingTop:D.visualTopHeight+D.menuBarHeight}):(v.css({marginTop:D.textTopHeight}),x.width(f-20-2))))}function i(){X(),g()}function F(t){for(var e=1;e<6;e++)setTimeout(t,500*e)}function n(){L.pageYOffset&&130<L.pageYOffset&&L.scrollTo(L.pageXOffset,0),u.addClass("wp-editor-expand"),V.on("scroll.editor-expand resize.editor-expand",function(t){g(t.type),clearTimeout(e),e=setTimeout(g,100)}),j.on("wp-collapse-menu.editor-expand postboxes-columnchange.editor-expand editor-classchange.editor-expand",g).on("postbox-toggled.editor-expand",function(){!A&&!R&&L.pageYOffset>Y&&(R=!0,L.scrollBy(0,-1),g(),L.scrollBy(0,1)),g()}).on("wp-window-resized.editor-expand",function(){p&&!p.isHidden()?p.execCommand("wpAutoResize"):X()}),v.on("focus.editor-expand input.editor-expand propertychange.editor-expand",X),v.on("keyup.editor-expand",t),r(),z&&z.pubsub.subscribe("hidden",i),p&&(p.settings.wp_autoresize_on=!0,p.execCommand("wpAutoResizeOn"),p.isHidden()||p.execCommand("wpAutoResize")),p&&!p.isHidden()||X(),g(),j.trigger("editor-expand-on")}function s(){var t=L.getUserSetting("ed_size");L.pageYOffset&&130<L.pageYOffset&&L.scrollTo(L.pageXOffset,0),u.removeClass("wp-editor-expand"),V.off(".editor-expand"),j.off(".editor-expand"),v.off(".editor-expand"),l(),z&&z.pubsub.unsubscribe("hidden",i),N.each([w,b,m,C,y,T,h,H,v,B],function(t,e){e&&e.attr("style","")}),E=k=A=R=!1,p&&(p.settings.wp_autoresize_on=!1,p.execCommand("wpAutoResizeOff"),p.isHidden()||(v.hide(),t&&p.theme.resizeTo(null,t))),t&&v.height(t),j.trigger("editor-expand-off")}x.insertAfter(v),x.css({"font-family":v.css("font-family"),"font-size":v.css("font-size"),"line-height":v.css("line-height"),"white-space":"pre-wrap","word-wrap":"break-word"}),j.on("tinymce-editor-init.editor-expand",function(t,f){var a=L.tinymce.util.VK,e=_.debounce(function(){N(".mce-floatpanel:hover").length||L.tinymce.ui.FloatPanel.hideAll(),N(".mce-tooltip").hide()},1e3,!0);function o(t){t=t.keyCode;t<=47&&t!==a.SPACEBAR&&t!==a.ENTER&&t!==a.DELETE&&t!==a.BACKSPACE&&t!==a.UP&&t!==a.LEFT&&t!==a.DOWN&&t!==a.UP||91<=t&&t<=93||112<=t&&t<=123||144===t||145===t||i(t)}function i(t){var e,o,i,n,s=function(){var t,e,o,i=f.selection.getNode();if(f.plugins.wpview&&(e=f.plugins.wpview.getView(i)))o=e.getBoundingClientRect();else{t=f.selection.getRng();try{o=t.getClientRects()[0]}catch(t){}o=o||i.getBoundingClientRect()}return!!o.height&&o}();s&&(o=(e=s.top+f.iframeElement.getBoundingClientRect().top)+s.height,e-=50,o+=50,i=D.adminBarHeight+D.toolsHeight+D.menuBarHeight+D.visualTopHeight,(n=D.windowHeight-(P?D.bottomHeight+D.statusBarHeight:0))-i<s.height||(e<i&&(t===a.UP||t===a.LEFT||t===a.BACKSPACE)?L.scrollTo(L.pageXOffset,e+L.pageYOffset-i):n<o&&L.scrollTo(L.pageXOffset,o+L.pageYOffset-n)))}function n(t){t.state||g()}function s(){V.on("scroll.mce-float-panels",e),setTimeout(function(){f.execCommand("wpAutoResize"),g()},300)}function d(){V.off("scroll.mce-float-panels"),setTimeout(function(){var t=h.offset().top;L.pageYOffset>t&&L.scrollTo(L.pageXOffset,t-D.adminBarHeight),X(),g()},100),g()}function c(){P=!P}"content"===f.id&&((p=f).settings.autoresize_min_height=U,w=h.find(".mce-toolbar-grp"),H=h.find(".mce-edit-area"),T=h.find(".mce-statusbar"),C=h.find(".mce-menubar"),r=function(){f.on("keyup",o),f.on("show",s),f.on("hide",d),f.on("wp-toolbar-toggle",c),f.on("setcontent wp-autoresize wp-toolbar-toggle",g),f.on("undo redo",i),f.on("FullscreenStateChanged",n),V.off("scroll.mce-float-panels").on("scroll.mce-float-panels",e)},l=function(){f.off("keyup",o),f.off("show",s),f.off("hide",d),f.off("wp-toolbar-toggle",c),f.off("setcontent wp-autoresize wp-toolbar-toggle",g),f.off("undo redo",i),f.off("FullscreenStateChanged",n),V.off("scroll.mce-float-panels")},u.hasClass("wp-editor-expand")&&(r(),F(g)))}),u.hasClass("wp-editor-expand")&&(n(),h.hasClass("html-active")&&F(function(){g(),X()})),N("#adv-settings .editor-expand").show(),N("#editor-expand-toggle").on("change.editor-expand",function(){N(this).prop("checked")?(n(),L.setUserSetting("editor_expand","on")):(s(),L.setUserSetting("editor_expand","off"))}),L.editorExpand={on:n,off:s}}),N(function(){var o,i,t,n,s,f,a,d,c,u,r,l=N(document.body),g=N("#wpcontent"),p=N("#post-body-content"),e=N("#title"),h=N("#content"),m=N(document.createElement("DIV")),w=N("#edit-slug-box"),H=w.find("a").add(w.find("button")).add(w.find("input")),b=N("#adminmenuwrap"),v=(N(),N(),"on"===L.getUserSetting("editor_expand","on")),x=!!v&&"on"===L.getUserSetting("post_dfw"),y=0,C=0,T=20;function B(){(n=p.offset()).right=n.left+p.outerWidth(),n.bottom=n.top+p.outerHeight()}function S(){v||(v=!0,j.trigger("dfw-activate"),h.on("keydown.focus-shortcut",K))}function O(){v&&(E(),v=!1,j.trigger("dfw-deactivate"),h.off("keydown.focus-shortcut"))}function z(){!x&&v&&(x=!0,h.on("keydown.focus",A),e.add(h).on("blur.focus",R),A(),L.setUserSetting("post_dfw","on"),j.trigger("dfw-on"))}function E(){x&&(x=!1,e.add(h).off(".focus"),_(),p.off(".focus"),L.setUserSetting("post_dfw","off"),j.trigger("dfw-off"))}function k(){(x?E:z)()}function A(t){var e=t&&t.keyCode;27===e||87===e&&t.altKey&&t.shiftKey?_(t):t&&(t.metaKey||t.ctrlKey&&!t.altKey||t.altKey&&t.shiftKey||e&&(e<=47&&8!==e&&13!==e&&32!==e&&46!==e||91<=e&&e<=93||112<=e&&e<=135||144<=e&&e<=150||224<=e))||(o||(o=!0,clearTimeout(u),u=setTimeout(function(){m.show()},600),p.css("z-index",9998),m.on("mouseenter.focus",function(){B(),V.on("scroll.focus",function(){var t=L.pageYOffset;d&&a&&d!==t&&(a<n.top-T||a>n.bottom+T)&&_(),d=t})}).on("mouseleave.focus",function(){s=f=null,y=C=0,V.off("scroll.focus")}).on("mousemove.focus",function(t){var e=t.clientX,o=t.clientY,i=L.pageYOffset,t=L.pageXOffset;if(s&&f&&(e!==s||o!==f))if(o<=f&&o<n.top-i||f<=o&&o>n.bottom-i||e<=s&&e<n.left-t||s<=e&&e>n.right-t){if(y+=Math.abs(s-e),C+=Math.abs(f-o),(o<=n.top-T-i||o>=n.bottom+T-i||e<=n.left-T-t||e>=n.right+T-t)&&(10<y||10<C))return _(),s=f=null,void(y=C=0)}else y=C=0;s=e,f=o}).on("touchstart.focus",function(t){t.preventDefault(),_()}),p.off("mouseenter.focus"),c&&(clearTimeout(c),c=null),l.addClass("focus-on").removeClass("focus-off")),!i&&o&&(i=!0,I.on("mouseenter.focus",function(){I.addClass("focus-off")}).on("mouseleave.focus",function(){I.removeClass("focus-off")})),W())}function _(t){o&&(o=!1,clearTimeout(u),u=setTimeout(function(){m.hide()},200),p.css("z-index",""),m.off("mouseenter.focus mouseleave.focus mousemove.focus touchstart.focus"),void 0===t&&p.on("mouseenter.focus",function(){(N.contains(p.get(0),document.activeElement)||r)&&A()}),c=setTimeout(function(){c=null,p.off("mouseenter.focus")},1e3),l.addClass("focus-off").removeClass("focus-on")),i&&(i=!1,I.off(".focus")),Y()}function R(){setTimeout(function(){var t=document.activeElement.compareDocumentPosition(p.get(0));function e(t){return N.contains(t.get(0),document.activeElement)}2!==t&&4!==t||!(e(b)||e(g)||e(M))||_()},0)}function W(){t||!o||w.find(":focus").length||(t=!0,w.stop().fadeTo("fast",.3).on("mouseenter.focus",Y).off("mouseleave.focus"),H.on("focus.focus",Y).off("blur.focus"))}function Y(){t&&(t=!1,w.stop().fadeTo("fast",1).on("mouseleave.focus",W).off("mouseenter.focus"),H.on("blur.focus",W).off("focus.focus"))}function K(t){t.altKey&&t.shiftKey&&87===t.keyCode&&k()}l.append(m),m.css({display:"none",position:"fixed",top:I.height(),right:0,bottom:0,left:0,"z-index":9997}),p.css({position:"relative"}),V.on("mousemove.focus",function(t){a=t.pageY}),N("#postdivrich").hasClass("wp-editor-expand")&&h.on("keydown.focus-shortcut",K),j.on("tinymce-editor-setup.focus",function(t,e){e.addButton("dfw",{active:x,classes:"wp-dfw btn widget",disabled:!v,onclick:k,onPostRender:function(){var t=this;j.on("dfw-activate.focus",function(){t.disabled(!1)}).on("dfw-deactivate.focus",function(){t.disabled(!0)}).on("dfw-on.focus",function(){t.active(!0)}).on("dfw-off.focus",function(){t.active(!1)})},tooltip:"Distraction-free writing mode",shortcut:"Alt+Shift+W"}),e.addCommand("wpToggleDFW",k),e.addShortcut("alt+shift+w","","wpToggleDFW")}),j.on("tinymce-editor-init.focus",function(t,e){var o,i;function n(){r=!0}function s(){r=!1}"content"===e.id&&(N(e.getWin()),N(e.getContentAreaContainer()).find("iframe"),o=function(){e.on("keydown",A),e.on("blur",R),e.on("focus",n),e.on("blur",s),e.on("wp-autoresize",B)},i=function(){e.off("keydown",A),e.off("blur",R),e.off("focus",n),e.off("blur",s),e.off("wp-autoresize",B)},x&&o(),j.on("dfw-on.focus",o).on("dfw-off.focus",i),e.on("click",function(t){t.target===e.getDoc().documentElement&&e.focus()}))}),j.on("quicktags-init",function(t,e){var o;e.settings.buttons&&-1!==(","+e.settings.buttons+",").indexOf(",dfw,")&&(o=N("#"+e.name+"_dfw"),N(document).on("dfw-activate",function(){o.prop("disabled",!1)}).on("dfw-deactivate",function(){o.prop("disabled",!0)}).on("dfw-on",function(){o.addClass("active")}).on("dfw-off",function(){o.removeClass("active")}))}),j.on("editor-expand-on.focus",S).on("editor-expand-off.focus",O),x&&(h.on("keydown.focus",A),e.add(h).on("blur.focus",R)),L.wp=L.wp||{},L.wp.editor=L.wp.editor||{},L.wp.editor.dfw={activate:S,deactivate:O,isActive:function(){return v},on:z,off:E,toggle:k,isOn:function(){return x}}})}(window,window.jQuery);