var tagBox,array_unique_noempty;!function(o){array_unique_noempty=function(t){var a=[];return o.each(t,function(t,i){(i=o.trim(i))&&-1===o.inArray(i,a)&&a.push(i)}),a},tagBox={clean:function(t){var i=window.tagsBoxL10n.tagDelimiter;return t=(t=","!==i?t.replace(new RegExp(i,"g"),","):t).replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,""),t=","!==i?t.replace(/,/g,i):t},parseTags:function(t){var i=t.id.split("-check-num-")[1],a=o(t).closest(".tagsdiv"),e=a.find(".the-tags"),n=window.tagsBoxL10n.tagDelimiter,t=e.val().split(n),s=[];return delete t[i],o.each(t,function(t,i){(i=o.trim(i))&&s.push(i)}),e.val(this.clean(s.join(n))),this.quickClicks(a),!1},quickClicks:function(t){var a,i=o(".the-tags",t),e=o(".tagchecklist",t),n=o(t).attr("id");i.length&&(a=i.prop("disabled"),i=i.val().split(window.tagsBoxL10n.tagDelimiter),e.empty(),o.each(i,function(t,i){(i=o.trim(i))&&(i=o("<span />").text(i),a||((t=o('<a id="'+n+"-check-num-"+t+'" class="ntdelbutton" tabindex="0">X</a>')).on("click keypress",function(t){"click"!==t.type&&13!==t.keyCode||(13===t.keyCode&&o(this).closest(".tagsdiv").find("input.newtag").focus(),tagBox.parseTags(this))}),i.prepend("&nbsp;").prepend(t)),e.append(i))}))},flushTags:function(t,i,a){var e,n,s=o(".the-tags",t),c=o("input.newtag",t),u=window.tagsBoxL10n.tagDelimiter;return void 0===(n=(i=i||!1)?o(i).text():c.val())||(n=(e=s.val())?e+u+n:n,n=this.clean(n),n=array_unique_noempty(n.split(u)).join(u),s.val(n),this.quickClicks(t),i||c.val(""),void 0===a&&c.focus()),!1},get:function(a){var e=a.substr(a.indexOf("-")+1);o.post(ajaxurl,{action:"get-tagcloud",tax:e},function(t,i){0!==t&&"success"==i&&(t=o('<p id="tagcloud-'+e+'" class="the-tagcloud">'+t+"</p>"),o("a",t).click(function(){return tagBox.flushTags(o("#"+e),this),!1}),o("#"+a).after(t))})},init:function(){var t=this,i=o("div.ajaxtag");o(".tagsdiv").each(function(){tagBox.quickClicks(this)}),o(".tagadd",i).click(function(){t.flushTags(o(this).closest(".tagsdiv"))}),o("input.newtag",i).keyup(function(t){if(13==t.which)return tagBox.flushTags(o(this).closest(".tagsdiv")),!1}).keypress(function(t){if(13==t.which)return t.preventDefault(),!1}).each(function(){var t=o(this).closest("div.tagsdiv").attr("id");o(this).suggest(ajaxurl+"?action=ajax-tag-search&tax="+t,{delay:500,minchars:2,multiple:!0,multipleSep:window.tagsBoxL10n.tagDelimiter+" "})}),o("#post").submit(function(){o("div.tagsdiv").each(function(){tagBox.flushTags(this,!1,1)})}),o(".tagcloud-link").click(function(){return tagBox.get(o(this).attr("id")),o(this).unbind().click(function(){return o(this).siblings(".the-tagcloud").toggle(),!1}),!1})}}}(jQuery);