var wpWidgets;!function(o){wpWidgets={init:function(){var a,l,e=o("div.widgets-sortables"),r=isRtl?"marginRight":"marginLeft";o("#widgets-right").children(".widgets-holder-wrap").children(".sidebar-name").click(function(){var e=o(this).siblings(".widgets-sortables"),i=o(this).parent();i.hasClass("closed")?(i.removeClass("closed"),e.sortable("enable").sortable("refresh")):(e.sortable("disable"),i.addClass("closed"))}),o("#widgets-left").children(".widgets-holder-wrap").children(".sidebar-name").click(function(){o(this).parent().toggleClass("closed")}),e.each(function(){if(o(this).parent().hasClass("inactive"))return!0;var e=o(this).children(".widget").length,i=50+parseInt(48*e,10);o(this).css("minHeight",i+"px")}),o(document.body).bind("click.widgets-toggle",function(e){var i,t,s,d=o(e.target),n={};d.parents(".widget-top").length&&!d.parents("#available-widgets").length?(t=(i=d.closest("div.widget")).children(".widget-inside"),s=parseInt(i.find("input.widget-width").val(),10),t.is(":hidden")?(250<s&&t.closest("div.widgets-sortables").length&&(n.width=s+30+"px",t.closest("div.widget-liquid-right").length&&(n[r]=235-s+"px"),i.css(n)),wpWidgets.fixLabels(i),t.slideDown("fast")):t.slideUp("fast",function(){i.css({width:"",margin:""})}),e.preventDefault()):d.hasClass("widget-control-save")?(wpWidgets.save(d.closest("div.widget"),0,1,0),e.preventDefault()):d.hasClass("widget-control-remove")?(wpWidgets.save(d.closest("div.widget"),1,1,0),e.preventDefault()):d.hasClass("widget-control-close")&&(wpWidgets.close(d.closest("div.widget")),e.preventDefault())}),e.children(".widget").each(function(){wpWidgets.appendTitle(this),o("p.widget-error",this).length&&o("a.widget-action",this).click()}),o("#widget-list").children(".widget").draggable({connectToSortable:"div.widgets-sortables",handle:"> .widget-top > .widget-title",distance:2,helper:"clone",zIndex:100,containment:"document",start:function(e,i){i.helper.find("div.widget-description").hide(),l=this.id},stop:function(e,i){a&&o(a).hide(),a=""}}),e.sortable({placeholder:"widget-placeholder",items:"> .widget",handle:"> .widget-top > .widget-title",cursor:"move",distance:2,containment:"document",start:function(e,i){i.item.children(".widget-inside").hide(),i.item.css({margin:"",width:""})},stop:function(e,i){if(i.item.hasClass("ui-draggable")&&i.item.data("draggable")&&i.item.draggable("destroy"),i.item.hasClass("deleting"))return wpWidgets.save(i.item,1,0,1),void i.item.remove();var t=i.item.find("input.add_new").val(),s=i.item.find("input.multi_number").val(),d=l,n=o(this).attr("id");if(i.item.css({margin:"",width:""}),l="",t)return"multi"==t?(i.item.html(i.item.html().replace(/<[^<>]+>/g,function(e){return e.replace(/__i__|%i%/g,s)})),i.item.attr("id",d.replace("__i__",s)),s++,o("div#"+d).find("input.multi_number").val(s)):"single"==t&&(i.item.attr("id","new-"+d),a="div#"+d),wpWidgets.save(i.item,0,0,1),i.item.find("input.add_new").val(""),void i.item.find("a.widget-action").click();wpWidgets.saveOrder(n)},receive:function(e,i){i=o(i.sender);o(this).is(":visible")&&-1==this.id.indexOf("orphaned_widgets")||i.sortable("cancel"),-1==i.attr("id").indexOf("orphaned_widgets")||i.children(".widget").length||i.parents(".orphan-sidebar").slideUp(400,function(){o(this).remove()})}}).sortable("option","connectWith","div.widgets-sortables").parent().filter(".closed").children(".widgets-sortables").sortable("disable"),o("#available-widgets").droppable({tolerance:"pointer",accept:function(e){return"widget-list"!=o(e).parent().attr("id")},drop:function(e,i){i.draggable.addClass("deleting"),o("#removing-widget").hide().children("span").html("")},over:function(e,i){i.draggable.addClass("deleting"),o("div.widget-placeholder").hide(),i.draggable.hasClass("ui-sortable-helper")&&o("#removing-widget").show().children("span").html(i.draggable.find("div.widget-title").children("h4").html())},out:function(e,i){i.draggable.removeClass("deleting"),o("div.widget-placeholder").show(),o("#removing-widget").hide().children("span").html("")}})},saveOrder:function(e){e&&o("#"+e).closest("div.widgets-holder-wrap").find(".spinner").css("display","inline-block");var i={action:"widgets-order",savewidgets:o("#_wpnonce_widgets").val(),sidebars:[]};o("div.widgets-sortables").each(function(){o(this).sortable&&(i["sidebars["+o(this).attr("id")+"]"]=o(this).sortable("toArray").join(","))}),o.post(ajaxurl,i,function(){o(".spinner").hide()}),this.resize()},save:function(t,s,d,n){var e=t.closest("div.widgets-sortables").attr("id"),i=t.find("form").serialize();t=o(t),o(".spinner",t).show(),e={action:"save-widget",savewidgets:o("#_wpnonce_widgets").val(),sidebar:e},s&&(e.delete_widget=1),i+="&"+o.param(e),o.post(ajaxurl,i,function(e){var i;s?(o("input.widget_number",t).val()||(i=o("input.widget-id",t).val(),o("#available-widgets").find("input.widget-id").each(function(){o(this).val()==i&&o(this).closest("div.widget").show()})),d?(n=0,t.slideUp("fast",function(){o(this).remove(),wpWidgets.saveOrder()})):(t.remove(),wpWidgets.resize())):(o(".spinner").hide(),e&&2<e.length&&(o("div.widget-content",t).html(e),wpWidgets.appendTitle(t),wpWidgets.fixLabels(t))),n&&wpWidgets.saveOrder()})},appendTitle:function(e){var i=(i=o('input[id*="-title"]',e).val()||"")&&": "+i.replace(/<[^<>]+>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;");o(e).children(".widget-top").children(".widget-title").children().children(".in-widget-title").html(i)},resize:function(){o("div.widgets-sortables").each(function(){if(o(this).parent().hasClass("inactive"))return!0;var e=o(this).children(".widget").length,i=50+parseInt(48*e,10);o(this).css("minHeight",i+"px")})},fixLabels:function(e){e.children(".widget-inside").find("label").each(function(){var e=o(this).attr("for");e&&e==o("input",this).attr("id")&&o(this).removeAttr("for")})},close:function(e){e.children(".widget-inside").slideUp("fast",function(){e.css({width:"",margin:""})})}},o(document).ready(function(e){wpWidgets.init()})}(jQuery);