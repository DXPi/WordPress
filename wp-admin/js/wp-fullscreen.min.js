!function(o,d){var s,n,r,t,i,e,a=0,l="transitionend webkitTransitionEnd",f=o(document.body),c=o(document);function u(){f.removeClass("wp-dfw-show-ui")}function w(s){r.$dfwWrap.parents().each(function(e,t){var i,n=o(t);if(s?(t.style.position&&n.data("wp-dfw-css-position",t.style.position),n.css("position","static")):(i=n.data("wp-dfw-css-position")||"",n.css("position",i)),"BODY"===t.nodeName)return!1})}n=(s={}).pubsub=new function(){this.topics={},this.subscribe=function(e,t){return this.topics[e]||(this.topics[e]=[]),this.topics[e].push(t),t},this.unsubscribe=function(e,t){var i,n,s=this.topics[e];if(!s)return t||[];if(t){for(i=0,n=s.length;i<n;i++)t==s[i]&&s.splice(i,1);return t}return this.topics[e]=[],s},this.publish=function(e,t){var i,n,s,o=this.topics[e];if(o){for(t=t||[],i=0,n=o.length;i<n;i++)s=!1===o[i].apply(null,t)||s;return!s}}},r=s.settings={visible:!1,mode:"tinymce",id:"",title_id:"",timer:0,toolbar_shown:!1},t=s.toggleUI=function(e){clearTimeout(i),f.hasClass("wp-dfw-show-ui")&&"show"!==e?"autohide"!==e&&f.removeClass("wp-dfw-show-ui"):f.addClass("wp-dfw-show-ui"),"autohide"===e&&(i=setTimeout(u,2e3))},s.on=function(){var e,t;if(!r.visible){if(r.$fullscreenFader||s.ui.init(),"object"==typeof d.wp_fullscreen_settings&&o.extend(r,d.wp_fullscreen_settings),!(t=r.id||d.wpActiveEditor)){if(!r.hasTinymce)return;t=tinymce.activeEditor.id}r.id=t,(e=r.$dfwWrap=o("#wp-"+t+"-wrap")).length&&(r.$dfwTextarea=o("#"+t),r.$editorContainer=e.find(".wp-editor-container"),a=c.scrollTop(),r.hasTinymce&&(r.editor=tinymce.get(t)),r.editor&&!r.editor.isHidden()?(r.origHeight=o("#"+t+"_ifr").height(),r.mode="tinymce"):(r.origHeight=r.$dfwTextarea.height(),r.mode="html"),t=void 0===d.adminpage||"post-php"!==d.adminpage&&"post-new-php"!==d.adminpage?t+"-title":"title",r.$dfwTitle=o("#"+t),r.$dfwTitle.length||(r.$dfwTitle=null),s.ui.fade("show","showing","shown"))}},s.off=function(){r.visible&&s.ui.fade("hide","hiding","hidden")},s.switchmode=function(e){var t=r.mode;return!(e&&r.visible&&r.hasTinymce&&"undefined"!=typeof switchEditors)||t==e?t:("tinymce"!==e||r.editor||(r.editor=tinymce.get(r.id),!r.editor&&"undefined"!=typeof tinyMCEPreInit&&tinyMCEPreInit.mceInit&&tinyMCEPreInit.mceInit[r.id]&&(tinyMCEPreInit.mceInit[r.id].wp_fullscreen=!0)),r.mode=e,switchEditors.go(r.id,e),s.refreshButtons(!0),"html"===e&&setTimeout(s.resizeTextarea,200),e)},s.save=function(){var e=o("#hiddenaction"),t=e.val(),i=o("#wp-fullscreen-save .spinner"),n=o("#wp-fullscreen-save .wp-fullscreen-saved-message"),s=o("#wp-fullscreen-save .wp-fullscreen-error-message");i.addClass("is-active"),s.hide(),n.hide(),e.val("wp-fullscreen-save-post"),r.editor&&!r.editor.isHidden()&&r.editor.save(),o.ajax({url:d.ajaxurl,type:"post",data:o("form#post").serialize(),dataType:"json"}).done(function(e){i.removeClass("is-active"),e&&e.success?(n.show(),setTimeout(function(){n.fadeOut(300)},3e3),e.data&&e.data.last_edited&&o("#wp-fullscreen-save input").attr("title",e.data.last_edited)):s.show()}).fail(function(){i.removeClass("is-active"),s.show()}),e.val(t)},s.dfwWidth=function(e,t){var i;return e&&-1!==e.toString().indexOf("%")?(r.$editorContainer.css("width",e),r.$statusbar.css("width",e),void(r.$dfwTitle&&r.$dfwTitle.css("width",e))):e?(t?i=e:(i=r.$editorContainer.width(),i+=e),void(i<200||1200<i||(r.$editorContainer.width(i),r.$statusbar.width(i),r.$dfwTitle&&r.$dfwTitle.width(i-16),setUserSetting("dfw_width",i)))):(i=o("#wp-fullscreen-body").data("theme-width")||800,r.$editorContainer.width(i),r.$statusbar.width(i),r.$dfwTitle&&r.$dfwTitle.width(i-16),void deleteUserSetting("dfw_width"))},n.subscribe("show",function(){var e=o("#last-edit").text();e&&o("#wp-fullscreen-save input").attr("title",e)}),n.subscribe("showing",function(){f.addClass("wp-fullscreen-active"),r.$dfwWrap.addClass("wp-fullscreen-wrap"),r.$dfwTitle&&(r.$dfwTitle.after('<span id="wp-fullscreen-title-placeholder">'),r.$dfwWrap.prepend(r.$dfwTitle.addClass("wp-fullscreen-title"))),s.refreshButtons(),w(!0),o("#wpadminbar").hide(),t("autohide"),s.bind_resize(),r.editor&&r.editor.execCommand("wpFullScreenOn"),"ontouchstart"in d?s.dfwWidth("90%"):s.dfwWidth(o("#wp-fullscreen-body").data("dfw-width")||800,!0),scrollTo(0,0)}),n.subscribe("shown",function(){r.visible=!0,r.editor&&!r.editor.isHidden()?r.editor.execCommand("wpAutoResize"):s.resizeTextarea("force")}),n.subscribe("hide",function(){c.unbind(".fullscreen"),r.$dfwTextarea.unbind(".wp-dfw-resize")}),n.subscribe("hiding",function(){f.removeClass("wp-fullscreen-active"),r.$dfwTitle&&o("#wp-fullscreen-title-placeholder").before(r.$dfwTitle.removeClass("wp-fullscreen-title").css("width","")).remove(),r.$dfwWrap.removeClass("wp-fullscreen-wrap"),r.$editorContainer.css("width",""),r.$dfwTextarea.add("#"+r.id+"_ifr").height(r.origHeight),r.editor&&r.editor.execCommand("wpFullScreenOff"),w(!1),d.scrollTo(0,a),o("#wpadminbar").show()}),n.subscribe("hidden",function(){r.visible=!1}),s.refreshButtons=function(e){"html"===r.mode?(o("#wp-fullscreen-mode-bar").removeClass("wp-tmce-mode").addClass("wp-html-mode").find("a").removeClass("active").filter(".wp-fullscreen-mode-html").addClass("active"),e?o("#wp-fullscreen-button-bar").fadeOut(150,function(){o(this).addClass("wp-html-mode").fadeIn(150)}):o("#wp-fullscreen-button-bar").addClass("wp-html-mode")):"tinymce"===r.mode&&(o("#wp-fullscreen-mode-bar").removeClass("wp-html-mode").addClass("wp-tmce-mode").find("a").removeClass("active").filter(".wp-fullscreen-mode-tinymce").addClass("active"),e?o("#wp-fullscreen-button-bar").fadeOut(150,function(){o(this).removeClass("wp-html-mode").fadeIn(150)}):o("#wp-fullscreen-button-bar").removeClass("wp-html-mode"))},s.ui={init:function(){var e;r.toolbar=e=o("#fullscreen-topbar"),r.$fullscreenFader=o("#fullscreen-fader"),r.$statusbar=o("#wp-fullscreen-status"),r.hasTinymce="undefined"!=typeof tinymce,r.hasTinymce||o("#wp-fullscreen-mode-bar").hide(),c.keyup(function(e){var t,i=e.keyCode||e.charCode;r.visible&&(!(t=navigator.platform&&-1!==navigator.platform.indexOf("Mac")?e.ctrlKey:e.altKey)||61!==i&&107!==i&&187!==i||(s.dfwWidth(25),e.preventDefault()),!t||45!==i&&109!==i&&189!==i||(s.dfwWidth(-25),e.preventDefault()),t&&48===i&&(s.dfwWidth(0),e.preventDefault()))}),o(d).on("keydown.wp-fullscreen",function(e){27===e.keyCode&&r.visible&&(s.off(),e.stopImmediatePropagation())}),"ontouchstart"in d&&f.addClass("wp-dfw-touch"),e.on("mouseenter",function(){t("show")}).on("mouseleave",function(){t("autohide")}),o("#wp-fullscreen-buttons").on("click.wp-fullscreen","button",function(e){e=e.currentTarget.id?e.currentTarget.id.substr(6):null;if(r.editor&&"tinymce"===r.mode)switch(e){case"bold":r.editor.execCommand("Bold");break;case"italic":r.editor.execCommand("Italic");break;case"bullist":r.editor.execCommand("InsertUnorderedList");break;case"numlist":r.editor.execCommand("InsertOrderedList");break;case"link":r.editor.execCommand("WP_Link");break;case"unlink":r.editor.execCommand("unlink");break;case"help":r.editor.execCommand("WP_Help");break;case"blockquote":r.editor.execCommand("mceBlockQuote")}else"link"===e&&d.wpLink&&d.wpLink.open();"wp-media-library"===e&&"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(r.id)})},fade:function(e,t,i){r.$fullscreenFader||s.ui.init(),e&&!n.publish(e)||s.fade.In(r.$fullscreenFader,200,function(){t&&n.publish(t),s.fade.Out(r.$fullscreenFader,200,function(){i&&n.publish(i)})})}},s.fade={sensitivity:100,In:function(e,t,i,n){if(i=i||o.noop,t=t||400,n=n||!1,s.fade.transitions){if(e.is(":visible"))return e.addClass("fade-trigger"),e;e.show(),e.first().one(l,function(){i()}),setTimeout(function(){e.addClass("fade-trigger")},this.sensitivity)}else n&&e.stop(),e.css("opacity",1),e.first().fadeIn(t,i),1<e.length&&e.not(":first").fadeIn(t);return e},Out:function(e,t,i,n){return i=i||o.noop,t=t||400,n=n||!1,e.is(":visible")&&(s.fade.transitions?(e.first().one(l,function(){e.hasClass("fade-trigger")||(e.hide(),i())}),setTimeout(function(){e.removeClass("fade-trigger")},this.sensitivity)):(n&&e.stop(),e.first().fadeOut(t,i),1<e.length&&e.not(":first").fadeOut(t))),e},transitions:"string"==typeof(e=document.documentElement.style).WebkitTransition||"string"==typeof e.MozTransition||"string"==typeof e.OTransition||"string"==typeof e.transition},s.bind_resize=function(){r.$dfwTextarea.on("keydown.wp-dfw-resize click.wp-dfw-resize paste.wp-dfw-resize",function(){s.resizeTextarea()})},s.resizeTextarea=function(){var e=r.$dfwTextarea[0];e.scrollHeight>e.clientHeight&&(e.style.height=e.scrollHeight+50+"px")},d.wp=d.wp||{},d.wp.editor=d.wp.editor||{},d.wp.editor.fullscreen=s}(jQuery,window);