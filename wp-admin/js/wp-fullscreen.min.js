var fullscreen,wptitlehint,PubSub=function(){this.topics={}};PubSub.prototype.subscribe=function(e,t){return this.topics[e]||(this.topics[e]=[]),this.topics[e].push(t),t},PubSub.prototype.unsubscribe=function(e,t){var i,n,o=this.topics[e];if(!o)return t||[];if(t){for(i=0,n=o.length;i<n;i++)t==o[i]&&o.splice(i,1);return t}return this.topics[e]=[],o},PubSub.prototype.publish=function(e,t){var i,n,o,s=this.topics[e];if(s){for(t=t||[],i=0,n=s.length;i<n;i++)o=!1===s[i].apply(null,t)||o;return!o}},function(l){var o,r,n,d,e;fullscreen=o={},r=o.pubsub=new PubSub,timer=0,block=!1,d=o.settings={visible:!1,mode:"tinymce",editor_id:"content",title_id:"",timer:0,toolbar_shown:!1},n=o.bounder=function(e,t,i,n){var o,s;i=i||1250,n&&(o=n.pageY||n.clientY||n.offsetY,s=l(document).scrollTop(),120<(o=!n.isDefaultPrevented?135+o:o)-s)||block||(block=!0,setTimeout(function(){block=!1},400),d.timer?clearTimeout(d.timer):r.publish(e),d.timer=setTimeout(function(){r.publish(t),d.timer=0},i))},o.on=function(){d.visible||("object"==typeof wp_fullscreen_settings&&l.extend(d,wp_fullscreen_settings),d.editor_id=wpActiveEditor||"content",l("input#title").length&&"content"==d.editor_id?d.title_id="title":l("input#"+d.editor_id+"-title").length?d.title_id=d.editor_id+"-title":l("#wp-fullscreen-title, #wp-fullscreen-title-prompt-text").hide(),d.mode=l("#"+d.editor_id).is(":hidden")?"tinymce":"html",d.qt_canvas=l("#"+d.editor_id).get(0),d.element||o.ui.init(),d.is_mce_on=d.has_tinymce&&void 0!==tinyMCE.get(d.editor_id),o.ui.fade("show","showing","shown"))},o.off=function(){d.visible&&o.ui.fade("hide","hiding","hidden")},o.switchmode=function(e){var t=d.mode;return!(e&&d.visible&&d.has_tinymce)||t==e?t:(r.publish("switchMode",[t,e]),d.mode=e,r.publish("switchedMode",[t,e]),e)},o.save=function(){var e=l("#hiddenaction"),t=e.val(),i=l("#wp-fullscreen-save .spinner"),n=l("#wp-fullscreen-save span");i.show(),o.savecontent(),e.val("wp-fullscreen-save-post"),l.post(ajaxurl,l("form#post").serialize(),function(e){i.hide(),n.show(),setTimeout(function(){n.fadeOut(1e3)},3e3),e.last_edited&&l("#wp-fullscreen-save input").attr("title",e.last_edited)},"json"),e.val(t)},o.savecontent=function(){var e;d.title_id&&l("#"+d.title_id).val(l("#wp-fullscreen-title").val()),e="tinymce"===d.mode&&(e=tinyMCE.get("wp_mce_fullscreen"))?e.save():l("#wp_mce_fullscreen").val(),l("#"+d.editor_id).val(e),l(document).triggerHandler("wpcountwords",[e])},set_title_hint=function(e){e.val().length?e.siblings("label").css("visibility","hidden"):e.siblings("label").css("visibility","")},o.dfw_width=function(e){var t=l("#wp-fullscreen-wrap"),i=t.width();if(!e)return t.width(l("#wp-fullscreen-central-toolbar").width()),void deleteUserSetting("dfw_width");(i=e+i)<200||1200<i||(t.width(i),setUserSetting("dfw_width",i))},r.subscribe("showToolbar",function(){d.toolbars.removeClass("fade-1000").addClass("fade-300"),o.fade.In(d.toolbars,300,function(){r.publish("toolbarShown")},!0),l("#wp-fullscreen-body").addClass("wp-fullscreen-focus"),d.toolbar_shown=!0}),r.subscribe("hideToolbar",function(){d.toolbars.removeClass("fade-300").addClass("fade-1000"),o.fade.Out(d.toolbars,1e3,function(){r.publish("toolbarHidden")},!0),l("#wp-fullscreen-body").removeClass("wp-fullscreen-focus")}),r.subscribe("toolbarShown",function(){d.toolbars.removeClass("fade-300")}),r.subscribe("toolbarHidden",function(){d.toolbars.removeClass("fade-1000"),d.toolbar_shown=!1}),r.subscribe("show",function(){var e;d.title_id&&(e=l("#wp-fullscreen-title").val(l("#"+d.title_id).val()),set_title_hint(e)),l("#wp-fullscreen-save input").attr("title",l("#last-edit").text()),d.textarea_obj.value=d.qt_canvas.value,d.has_tinymce&&"tinymce"===d.mode&&tinyMCE.execCommand("wpFullScreenInit"),d.orig_y=l(window).scrollTop()}),r.subscribe("showing",function(){l(document.body).addClass("fullscreen-active"),o.refresh_buttons(),l(document).bind("mousemove.fullscreen",function(e){n("showToolbar","hideToolbar",2e3,e)}),n("showToolbar","hideToolbar",2e3),o.bind_resize(),setTimeout(o.resize_textarea,200),scrollTo(0,0),l("#wpadminbar").hide()}),r.subscribe("shown",function(){var s;d.visible=!0,d.has_tinymce&&!d.is_mce_on&&(s=function(e,t){var i=t.getElement(),n=i.value,o=tinyMCEPreInit.mceInit[d.editor_id];o&&o.wpautop&&"undefined"!=typeof switchEditors&&(i.value=switchEditors.wpautop(i.value)),t.onInit.add(function(e){e.hide(),e.getElement().value=n,tinymce.onAddEditor.remove(s)})},tinymce.onAddEditor.add(s),tinyMCE.init(tinyMCEPreInit.mceInit[d.editor_id]),d.is_mce_on=!0),wpActiveEditor="wp_mce_fullscreen"}),r.subscribe("hide",function(){var e=l("#"+d.editor_id).is(":hidden");d.has_tinymce&&"tinymce"===d.mode&&!e?switchEditors.go(d.editor_id,"tmce"):"html"===d.mode&&e&&switchEditors.go(d.editor_id,"html"),o.savecontent(),l(document).unbind(".fullscreen"),l(d.textarea_obj).unbind(".grow"),d.has_tinymce&&"tinymce"===d.mode&&tinyMCE.execCommand("wpFullScreenSave"),d.title_id&&set_title_hint(l("#"+d.title_id)),d.qt_canvas.value=d.textarea_obj.value}),r.subscribe("hiding",function(){l(document.body).removeClass("fullscreen-active"),scrollTo(0,d.orig_y),l("#wpadminbar").show()}),r.subscribe("hidden",function(){d.visible=!1,l("#wp_mce_fullscreen, #wp-fullscreen-title").removeAttr("style"),d.has_tinymce&&d.is_mce_on&&tinyMCE.execCommand("wpFullScreenClose"),d.textarea_obj.value="",o.oldheight=0,wpActiveEditor=d.editor_id}),r.subscribe("switchMode",function(e,t){var i;d.has_tinymce&&d.is_mce_on&&(i=tinyMCE.get("wp_mce_fullscreen"),"html"===e&&"tinymce"===t?(tinyMCE.get(d.editor_id).getParam("wpautop")&&"undefined"!=typeof switchEditors&&(d.textarea_obj.value=switchEditors.wpautop(d.textarea_obj.value)),void 0===i?tinyMCE.execCommand("wpFullScreenInit"):i.show()):"tinymce"===e&&"html"===t&&i&&i.hide())}),r.subscribe("switchedMode",function(e,t){o.refresh_buttons(!0),"html"===t&&setTimeout(o.resize_textarea,200)}),o.b=function(){d.has_tinymce&&"tinymce"===d.mode&&tinyMCE.execCommand("Bold")},o.i=function(){d.has_tinymce&&"tinymce"===d.mode&&tinyMCE.execCommand("Italic")},o.ul=function(){d.has_tinymce&&"tinymce"===d.mode&&tinyMCE.execCommand("InsertUnorderedList")},o.ol=function(){d.has_tinymce&&"tinymce"===d.mode&&tinyMCE.execCommand("InsertOrderedList")},o.link=function(){d.has_tinymce&&"tinymce"===d.mode?tinyMCE.execCommand("WP_Link"):wpLink.open()},o.unlink=function(){d.has_tinymce&&"tinymce"===d.mode&&tinyMCE.execCommand("unlink")},o.atd=function(){d.has_tinymce&&"tinymce"===d.mode&&tinyMCE.execCommand("mceWritingImprovementTool")},o.help=function(){d.has_tinymce&&"tinymce"===d.mode&&tinyMCE.execCommand("WP_Help")},o.blockquote=function(){d.has_tinymce&&"tinymce"===d.mode&&tinyMCE.execCommand("mceBlockQuote")},o.medialib=function(){"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(d.editor_id)},o.refresh_buttons=function(e){e=e||!1,"html"===d.mode?(l("#wp-fullscreen-mode-bar").removeClass("wp-tmce-mode").addClass("wp-html-mode"),e?l("#wp-fullscreen-button-bar").fadeOut(150,function(){l(this).addClass("wp-html-mode").fadeIn(150)}):l("#wp-fullscreen-button-bar").addClass("wp-html-mode")):"tinymce"===d.mode&&(l("#wp-fullscreen-mode-bar").removeClass("wp-html-mode").addClass("wp-tmce-mode"),e?l("#wp-fullscreen-button-bar").fadeOut(150,function(){l(this).removeClass("wp-html-mode").fadeIn(150)}):l("#wp-fullscreen-button-bar").removeClass("wp-html-mode"))},o.ui={init:function(){var e=l("#fullscreen-topbar"),t=l("#wp_mce_fullscreen"),i=0;d.toolbars=e.add(l("#wp-fullscreen-status")),d.element=l("#fullscreen-fader"),d.textarea_obj=t[0],d.has_tinymce="undefined"!=typeof tinymce,d.has_tinymce||l("#wp-fullscreen-mode-bar").hide(),wptitlehint&&l("#wp-fullscreen-title").length&&wptitlehint("wp-fullscreen-title"),l(document).keyup(function(e){var t,i=e.keyCode||e.charCode;return!fullscreen.settings.visible||(t=navigator.platform&&-1!=navigator.platform.indexOf("Mac")?e.ctrlKey:e.altKey,27==i&&(e={event:e,what:"dfw",cb:fullscreen.off,condition:function(){return!l("#TB_window").is(":visible")&&!l(".wp-dialog").is(":visible")}},jQuery(document).triggerHandler("wp_CloseOnEscape",[e])||fullscreen.off()),!t||61!=i&&107!=i&&187!=i||o.dfw_width(25),!t||45!=i&&109!=i&&189!=i||o.dfw_width(-25),t&&48==i&&o.dfw_width(0),!1)}),"undefined"!=typeof wpWordCount&&t.keyup(function(e){e=e.keyCode||e.charCode;return e==i||(13!=e&&8!=i&&46!=i||l(document).triggerHandler("wpcountwords",[t.val()]),i=e),!0}),e.mouseenter(function(e){d.toolbars.addClass("fullscreen-make-sticky"),l(document).unbind(".fullscreen"),clearTimeout(d.timer),d.timer=0}).mouseleave(function(e){d.toolbars.removeClass("fullscreen-make-sticky"),d.visible&&l(document).bind("mousemove.fullscreen",function(e){n("showToolbar","hideToolbar",2e3,e)})})},fade:function(e,t,i){d.element||o.ui.init(),e&&!r.publish(e)||o.fade.In(d.element,600,function(){t&&r.publish(t),o.fade.Out(d.element,600,function(){i&&r.publish(i)})})}},o.fade={transitionend:"transitionend webkitTransitionEnd oTransitionEnd",sensitivity:100,In:function(e,t,i,n){if(i=i||l.noop,t=t||400,n=n||!1,o.fade.transitions){if(e.is(":visible"))return e.addClass("fade-trigger"),e;e.show(),e.first().one(this.transitionend,function(){i()}),setTimeout(function(){e.addClass("fade-trigger")},this.sensitivity)}else n&&e.stop(),e.css("opacity",1),e.first().fadeIn(t,i),1<e.length&&e.not(":first").fadeIn(t);return e},Out:function(e,t,i,n){return i=i||l.noop,t=t||400,n=n||!1,e.is(":visible")&&(o.fade.transitions?(e.first().one(o.fade.transitionend,function(){e.hasClass("fade-trigger")||(e.hide(),i())}),setTimeout(function(){e.removeClass("fade-trigger")},this.sensitivity)):(n&&e.stop(),e.first().fadeOut(t,i),1<e.length&&e.not(":first").fadeOut(t))),e},transitions:"string"==typeof(e=document.documentElement.style).WebkitTransition||"string"==typeof e.MozTransition||"string"==typeof e.OTransition||"string"==typeof e.transition},o.bind_resize=function(){l(d.textarea_obj).bind("keypress.grow click.grow paste.grow",function(){setTimeout(o.resize_textarea,200)})},o.oldheight=0,o.resize_textarea=function(){var e=d.textarea_obj,t=300<e.scrollHeight?e.scrollHeight:300;t!=o.oldheight&&(e.style.height=t+"px",o.oldheight=t)}}(jQuery);