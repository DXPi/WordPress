!function(u){var i,e,t,h=wp.customize;h.Setting=h.Value.extend({initialize:function(e,t,n){h.Value.prototype.initialize.call(this,t,n),this.id=e,this.transport=this.transport||"refresh",this.bind(this.preview)},preview:function(){switch(this.transport){case"refresh":return this.previewer.refresh();case"postMessage":return this.previewer.send("setting",[this.id,this()])}}}),h.utils={},h.utils.bubbleChildValueChanges=function(n,e){u.each(e,function(e,t){n[t].bind(function(e,t){n.parent&&e!==t&&n.parent.trigger("change",n)})})},e=function(e){var t,n=this,i=function(){n.container.find(":focusable:first").focus(),n.container[0].scrollIntoView(!0)};(e=e||{}).completeCallback?(t=e.completeCallback,e.completeCallback=function(){i(),t()}):e.completeCallback=i,n.expand?n.expand(e):e.completeCallback()},h.utils.prioritySort=function(e,t){return e.priority()===t.priority()&&"number"==typeof e.params.instanceNumber&&"number"==typeof t.params.instanceNumber?e.params.instanceNumber-t.params.instanceNumber:e.priority()-t.priority()},h.utils.isKeydownButNotEnterEvent=function(e){return"keydown"===e.type&&13!==e.which},h.utils.areElementListsEqual=function(e,t){return e.length===t.length&&-1===_.indexOf(_.map(_.zip(e,t),function(e){return u(e[0]).is(e[1])}),!1)},i=h.Class.extend({defaultActiveArguments:{duration:"fast",completeCallback:u.noop},defaultExpandedArguments:{duration:"fast",completeCallback:u.noop},initialize:function(e,t){var n=this;n.id=e,n.params={},u.extend(n,t||{}),n.container=u(n.params.content),n.deferred={embedded:new u.Deferred},n.priority=new h.Value,n.active=new h.Value,n.activeArgumentsQueue=[],n.expanded=new h.Value,n.expandedArgumentsQueue=[],n.active.bind(function(e){var t=n.activeArgumentsQueue.shift(),t=u.extend({},n.defaultActiveArguments,t);e=e&&n.isContextuallyActive(),n.onChangeActive(e,t)}),n.expanded.bind(function(e){var t=n.expandedArgumentsQueue.shift(),t=u.extend({},n.defaultExpandedArguments,t);n.onChangeExpanded(e,t)}),n.attachEvents(),h.utils.bubbleChildValueChanges(n,["priority","active"]),n.priority.set(isNaN(n.params.priority)?100:n.params.priority),n.active.set(n.params.active),n.expanded.set(!1)},ready:function(){},_children:function(t,e){var n=this,i=[];return h[e].each(function(e){e[t].get()===n.id&&i.push(e)}),i.sort(h.utils.prioritySort),i},isContextuallyActive:function(){throw new Error("Container.isContextuallyActive() must be overridden in a subclass.")},onChangeActive:function(e,t){var n="resolved"===h.previewer.deferred.active.state()?t.duration:0;u.contains(document,this.container)?e?this.container.stop(!0,!0).slideDown(n,t.completeCallback):this.container.stop(!0,!0).slideUp(n,t.completeCallback):(this.container.toggle(e),t.completeCallback&&t.completeCallback())},_toggleActive:function(e,t){return t=t||{},e&&this.active.get()||!e&&!this.active.get()?(t.unchanged=!0,this.onChangeActive(this.active.get(),t),!1):(t.unchanged=!1,this.activeArgumentsQueue.push(t),this.active.set(e),!0)},activate:function(e){return this._toggleActive(!0,e)},deactivate:function(e){return this._toggleActive(!1,e)},onChangeExpanded:function(){throw new Error("Must override with subclass.")},_toggleExpanded:function(e,t){return t=t||{},e&&this.expanded.get()||!e&&!this.expanded.get()?(t.unchanged=!0,this.onChangeExpanded(this.expanded.get(),t),!1):(t.unchanged=!1,this.expandedArgumentsQueue.push(t),this.expanded.set(e),!0)},expand:function(e){return this._toggleExpanded(!0,e)},collapse:function(e){return this._toggleExpanded(!1,e)},focus:e}),h.Section=i.extend({initialize:function(e,t){var n=this;i.prototype.initialize.call(n,e,t),n.id=e,n.panel=new h.Value,n.panel.bind(function(e){u(n.container).toggleClass("control-subsection",!!e)}),n.panel.set(n.params.panel||""),h.utils.bubbleChildValueChanges(n,["panel"]),n.embed(),n.deferred.embedded.done(function(){n.ready()})},embed:function(){var n=this,e=function(e){var t;e?h.panel(e,function(e){e.deferred.embedded.done(function(){t=e.container.find("ul:first"),n.container.parent().is(t)||t.append(n.container),n.deferred.embedded.resolve()})}):(t=u("#customize-theme-controls").children("ul"),n.container.parent().is(t)||t.append(n.container),n.deferred.embedded.resolve())};n.panel.bind(e),e(n.panel.get())},attachEvents:function(){var t=this;t.container.find(".accordion-section-title").on("click keydown",function(e){h.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),t.expanded()?t.collapse():t.expand())})},isContextuallyActive:function(){var e=this.controls(),t=0;return _(e).each(function(e){e.active()&&(t+=1)}),0!==t},controls:function(){return this._children("section","control")},onChangeExpanded:function(e,t){var n=this,i=n.container.find(".accordion-section-content");e?(e=t.unchanged?t.completeCallback:function(){i.stop().slideDown(t.duration,t.completeCallback),n.container.addClass("open")},t.allowMultiple||h.section.each(function(e){e!==n&&e.collapse({duration:t.duration})}),n.panel()?h.panel(n.panel()).expand({duration:t.duration,completeCallback:e}):e()):(n.container.removeClass("open"),i.slideUp(t.duration,t.completeCallback))}}),h.Panel=i.extend({initialize:function(e,t){var n=this;i.prototype.initialize.call(n,e,t),n.embed(),n.deferred.embedded.done(function(){n.ready()})},embed:function(){var e=u("#customize-theme-controls > ul");this.container.parent().is(e)||e.append(this.container),this.deferred.embedded.resolve()},attachEvents:function(){var t,n=this;n.container.find(".accordion-section-title").on("click keydown",function(e){h.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),n.expanded()||n.expand())}),(t=n.container.find(".panel-meta:first")).find("> .accordion-section-title").on("click keydown",function(e){h.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),t.hasClass("cannot-expand")||(e=t.find(".accordion-section-content:first"),t.hasClass("open")?(t.toggleClass("open"),e.slideUp(n.defaultExpandedArguments.duration)):(e.slideDown(n.defaultExpandedArguments.duration),t.toggleClass("open"))))})},sections:function(){return this._children("panel","section")},isContextuallyActive:function(){var e=this.sections(),t=0;return _(e).each(function(e){e.active()&&e.isContextuallyActive()&&(t+=1)}),0!==t},onChangeExpanded:function(e,t){var n,i,o,a,r,s,c,l,d,u,p;t.unchanged?t.completeCallback&&t.completeCallback():(a=(o=this).container.closest(".accordion-section"),r=a.closest(".wp-full-overlay"),c=(s=a.closest(".accordion-container")).find(".open"),l=r.find("#customize-theme-controls > ul > .accordion-section > .accordion-section-title").add("#customize-info > .accordion-section-title"),d=r.find(".control-panel-back"),u=a.find(".accordion-section-title").first(),p=a.find(".control-panel-content"),e?(h.section.each(function(e){e.panel()||e.collapse({duration:0})}),h.panel.each(function(e){o!==e&&e.collapse({duration:0})}),p.show(0,function(){n=p.offset().top,i=s.scrollTop(),p.css("margin-top",45-n-i),a.addClass("current-panel"),r.addClass("in-sub-panel"),s.scrollTop(0),t.completeCallback&&t.completeCallback()}),l.attr("tabindex","-1"),d.attr("tabindex","0"),d.focus()):(c.removeClass("open"),a.removeClass("current-panel"),r.removeClass("in-sub-panel"),p.delay(180).hide(0,function(){p.css("margin-top","inherit"),t.completeCallback&&t.completeCallback()}),l.attr("tabindex","0"),d.attr("tabindex","-1"),u.focus(),s.scrollTop(0)))}}),h.Control=h.Class.extend({defaultActiveArguments:{duration:"fast",completeCallback:u.noop},initialize:function(e,t){var i,o,a=this;a.params={},u.extend(a,t||{}),a.id=e,a.selector="#customize-control-"+e.replace(/\]/g,"").replace(/\[/g,"-"),a.templateSelector="customize-control-"+a.params.type+"-content",a.container=a.params.content?u(a.params.content):u(a.selector),a.deferred={embedded:new u.Deferred},a.section=new h.Value,a.priority=new h.Value,a.active=new h.Value,a.activeArgumentsQueue=[],a.elements=[],i=a.container.find("[data-customize-setting-link]"),o={},i.each(function(){var e,n=u(this);if(n.is(":radio")){if(e=n.prop("name"),o[e])return;o[e]=!0,n=i.filter('[name="'+e+'"]')}h(n.data("customizeSettingLink"),function(e){var t=new h.Element(n);a.elements.push(t),t.sync(e),t.set(e())})}),a.active.bind(function(e){var t=a.activeArgumentsQueue.shift(),t=u.extend({},a.defaultActiveArguments,t);a.onChangeActive(e,t)}),a.section.set(a.params.section),a.priority.set(isNaN(a.params.priority)?10:a.params.priority),a.active.set(a.params.active),h.utils.bubbleChildValueChanges(a,["section","priority","active"]),e=u.map(a.params.settings,function(e){return e}),h.apply(h,e.concat(function(){for(var e in a.settings={},a.params.settings)a.settings[e]=h(a.params.settings[e]);a.setting=a.settings["default"]||null,a.embed()})),a.deferred.embedded.done(function(){a.ready()})},embed:function(){var n=this,e=function(e){var t;e&&h.section(e,function(e){e.deferred.embedded.done(function(){t=e.container.find("ul:first"),n.container.parent().is(t)||(t.append(n.container),n.renderContent()),n.deferred.embedded.resolve()})})};n.section.bind(e),e(n.section.get())},ready:function(){},expand:function(e){h.section(this.section()).expand(e)},focus:e,onChangeActive:function(e,t){u.contains(document,this.container)?e?this.container.slideDown(t.duration,t.completeCallback):this.container.slideUp(t.duration,t.completeCallback):(this.container.toggle(e),t.completeCallback&&t.completeCallback())},toggle:function(e){return this.onChangeActive(e,this.defaultActiveArguments)},activate:i.prototype.activate,deactivate:i.prototype.deactivate,_toggleActive:i.prototype._toggleActive,dropdownInit:function(){function e(e){"string"==typeof e&&i.statuses&&i.statuses[e]?n.html(i.statuses[e]).show():n.hide()}var t=this,n=this.container.find(".dropdown-status"),i=this.params,o=!1;this.container.on("click keydown",".dropdown",function(e){h.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),o||t.container.toggleClass("open"),t.container.hasClass("open")&&t.container.parent().parent().find("li.library-selected").focus(),o=!0,setTimeout(function(){o=!1},400))}),this.setting.bind(e),e(this.setting())},renderContent:function(){var e,t=this;0!==u("#tmpl-"+t.templateSelector).length&&(e=wp.template(t.templateSelector))&&t.container&&t.container.html(e(t.params))}}),h.ColorControl=h.Control.extend({ready:function(){var e=this,t=this.container.find(".color-picker-hex");t.val(e.setting()).wpColorPicker({change:function(){e.setting.set(t.wpColorPicker("color"))},clear:function(){e.setting.set(!1)}}),this.setting.bind(function(e){t.val(e),t.wpColorPicker("color",e)})}}),h.UploadControl=h.Control.extend({ready:function(){var e=this;_.bindAll(e,"restoreDefault","removeFile","openFrame","select"),e.container.on("click keydown",".upload-button",e.openFrame),e.container.on("click keydown",".thumbnail-image img",e.openFrame),e.container.on("click keydown",".default-button",e.restoreDefault),e.container.on("click keydown",".remove-button",e.removeFile),e.setting.bind(function(){e.renderContent()})},openFrame:function(e){h.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.frame||this.initFrame(),this.frame.open())},initFrame:function(){this.frame=wp.media({button:{text:this.params.button_labels.frame_button},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:this.params.mime_type}),multiple:!1,date:!1})]}),this.frame.on("select",this.select)},select:function(){var e=this.frame.state().get("selection").first().toJSON();this.params.attachment=e,this.setting(e.url)},restoreDefault:function(e){h.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.params.attachment=this.params.defaultAttachment,this.setting(this.params.defaultAttachment.url))},removeFile:function(e){h.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.params.attachment={},this.setting(""),this.renderContent())},success:function(){},removerVisibility:function(){}}),h.ImageControl=h.UploadControl.extend({thumbnailSrc:function(){}}),h.BackgroundControl=h.UploadControl.extend({ready:function(){h.UploadControl.prototype.ready.apply(this,arguments)},select:function(){h.UploadControl.prototype.select.apply(this,arguments),wp.ajax.post("custom-background-add",{nonce:_wpCustomizeBackground.nonces.add,wp_customize:"on",theme:h.settings.theme.stylesheet,attachment_id:this.params.attachment.id})}}),h.HeaderControl=h.Control.extend({ready:function(){this.btnRemove=u("#customize-control-header_image .actions .remove"),this.btnNew=u("#customize-control-header_image .actions .new"),_.bindAll(this,"openMedia","removeImage"),this.btnNew.on("click",this.openMedia),this.btnRemove.on("click",this.removeImage),h.HeaderTool.currentHeader=new h.HeaderTool.ImageModel,new h.HeaderTool.CurrentView({model:h.HeaderTool.currentHeader,el:"#customize-control-header_image .current .container"}),new h.HeaderTool.ChoiceListView({collection:h.HeaderTool.UploadsList=new h.HeaderTool.ChoiceList,el:"#customize-control-header_image .choices .uploaded .list"}),new h.HeaderTool.ChoiceListView({collection:h.HeaderTool.DefaultsList=new h.HeaderTool.DefaultsList,el:"#customize-control-header_image .choices .default .list"}),h.HeaderTool.combinedList=h.HeaderTool.CombinedList=new h.HeaderTool.CombinedList([h.HeaderTool.UploadsList,h.HeaderTool.DefaultsList])},calculateImageSelectOptions:function(e,t){var n=parseInt(_wpCustomizeHeader.data.width,10),i=parseInt(_wpCustomizeHeader.data.height,10),o=!!parseInt(_wpCustomizeHeader.data["flex-width"],10),a=!!parseInt(_wpCustomizeHeader.data["flex-height"],10),r=e.get("width"),e=e.get("height");return this.headerImage=new h.HeaderTool.ImageModel,this.headerImage.set({themeWidth:n,themeHeight:i,themeFlexWidth:o,themeFlexHeight:a,imageWidth:r,imageHeight:e}),t.set("canSkipCrop",!this.headerImage.shouldBeCropped()),(t=n/i)<r/e?n=(i=e)*t:i=(n=r)/t,!(e={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:r,imageHeight:e,x1:0,y1:0,x2:n,y2:i})==a&&!1==o&&(e.aspectRatio=n+":"+i),!1==a&&(e.maxHeight=i),!1==o&&(e.maxWidth=n),e},openMedia:function(e){var t=_wpMediaViewsL10n;e.preventDefault(),this.frame=wp.media({button:{text:t.selectAndCrop,close:!1},states:[new wp.media.controller.Library({title:t.chooseImage,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:_wpCustomizeHeader.data.width,suggestedHeight:_wpCustomizeHeader.data.height}),new wp.media.controller.Cropper({imgSelectOptions:this.calculateImageSelectOptions})]}),this.frame.on("select",this.onSelect,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this),this.frame.open()},onSelect:function(){this.frame.setState("cropper")},onCropped:function(e){var t=e.post_content,n=e.attachment_id,i=e.width,e=e.height;this.setImageFromURL(t,n,i,e)},onSkippedCrop:function(e){var t=e.get("url"),n=e.get("width"),i=e.get("height");this.setImageFromURL(t,e.id,n,i)},setImageFromURL:function(e,t,n,i){var o={};o.url=e,o.thumbnail_url=e,o.timestamp=_.now(),t&&(o.attachment_id=t),n&&(o.width=n),i&&(o.height=i),e=new h.HeaderTool.ImageModel({header:o,choice:e.split("/").pop()}),h.HeaderTool.UploadsList.add(e),h.HeaderTool.currentHeader.set(e.toJSON()),e.save(),e.importImage()},removeImage:function(){h.HeaderTool.currentHeader.trigger("hide"),h.HeaderTool.CombinedList.trigger("control:removeImage")}}),h.defaultConstructor=h.Setting,h.control=new h.Values({defaultConstructor:h.Control}),h.section=new h.Values({defaultConstructor:h.Section}),h.panel=new h.Values({defaultConstructor:h.Panel}),h.PreviewFrame=h.Messenger.extend({sensitivity:2e3,initialize:function(e,t){var n=u.Deferred();n.promise(this),this.container=e.container,this.signature=e.signature,u.extend(e,{channel:h.PreviewFrame.uuid()}),h.Messenger.prototype.initialize.call(this,e,t),this.add("previewUrl",e.previewUrl),this.query=u.extend(e.query||{},{customize_messenger_channel:this.channel()}),this.run(n)},run:function(i){var o=this,a=!1,r=!1;this._ready&&this.unbind("ready",this._ready),this._ready=function(){r=!0,a&&i.resolveWith(o)},this.bind("ready",this._ready),this.bind("ready",function(e){e&&(e={panel:e.activePanels,section:e.activeSections,control:e.activeControls},_(e).each(function(n,e){h[e].each(function(e,t){t=!(!n||!n[t]);e.active(t)})}))}),this.request=u.ajax(this.previewUrl(),{type:"POST",data:this.query,xhrFields:{withCredentials:!0}}),this.request.fail(function(){i.rejectWith(o,["request failure"])}),this.request.done(function(e){var t=o.request.getResponseHeader("Location"),n=o.signature;t&&t!==o.previewUrl()?i.rejectWith(o,["redirect",t]):"0"!==e?"-1"!==e?-1===(t=e.lastIndexOf(n))||t<e.lastIndexOf("</html>")?i.rejectWith(o,["unsigned"]):(e=e.slice(0,t)+e.slice(t+n.length),o.iframe=u("<iframe />").appendTo(o.container),o.iframe.one("load",function(){a=!0,r?i.resolveWith(o):setTimeout(function(){i.rejectWith(o,["ready timeout"])},o.sensitivity)}),o.targetWindow(o.iframe[0].contentWindow),o.targetWindow().document.open(),o.targetWindow().document.write(e),o.targetWindow().document.close()):i.rejectWith(o,["cheatin"]):o.login(i)})},login:function(n){var i=this,o=function(){n.rejectWith(i,["logged out"])};if(this.triedLogin)return o();u.get(h.settings.url.ajax,{action:"logged-in"}).fail(o).done(function(e){var t;"1"!==e&&o(),(t=u('<iframe src="'+i.previewUrl()+'" />').hide()).appendTo(i.container),t.load(function(){i.triedLogin=!0,t.remove(),i.run(n)})})},destroy:function(){h.Messenger.prototype.destroy.call(this),this.request.abort(),this.iframe&&this.iframe.remove(),delete this.request,delete this.iframe,delete this.targetWindow}}),t=0,h.PreviewFrame.uuid=function(){return"preview-"+t++},h.setDocumentTitle=function(e){e=h.settings.documentTitleTmpl.replace("%s",e);document.title=e,window!==window.parent&&(window.parent.document.title=document.title)},h.Previewer=h.Messenger.extend({refreshBuffer:250,initialize:function(e,t){var n,i,o,a=this,r=/^https?/;function s(){i=null,o.call(n)}u.extend(this,t||{}),this.deferred={active:u.Deferred()},this.refresh=(o=(n=this).refresh,function(){if("number"!=typeof i){if(!n.loading)return s();n.abort()}clearTimeout(i),i=setTimeout(s,n.refreshBuffer)}),this.container=h.ensure(e.container),this.allowedUrls=e.allowedUrls,this.signature=e.signature,e.url=window.location.href,h.Messenger.prototype.initialize.call(this,e),this.add("scheme",this.origin()).link(this.origin).setter(function(e){e=e.match(r);return e?e[0]:""}),this.add("previewUrl",e.previewUrl).setter(function(e){var o;return/\/wp-admin(\/|$)/.test(e.replace(/[#?].*$/,""))?null:(u.each([e.replace(r,a.scheme()),e],function(e,i){if(u.each(a.allowedUrls,function(e,t){var n;if(t=t.replace(/\/+$/,""),n=i.replace(t,""),0===i.indexOf(t)&&/^([/#?]|$)/.test(n))return o=i,!1}),o)return!1}),o||null)}),this.previewUrl.bind(this.refresh),this.scroll=0,this.bind("scroll",function(e){this.scroll=e}),this.bind("url",this.previewUrl),this.bind("documentTitle",function(e){h.setDocumentTitle(e)})},query:function(){},abort:function(){this.loading&&(this.loading.destroy(),delete this.loading)},refresh:function(){var n=this;this.abort(),this.loading=new h.PreviewFrame({url:this.url(),previewUrl:this.previewUrl(),query:this.query()||{},container:this.container,signature:this.signature}),this.loading.done(function(){this.bind("synced",function(){n.preview&&n.preview.destroy(),n.preview=this,delete n.loading,n.targetWindow(this.targetWindow()),n.channel(this.channel()),n.deferred.active.resolve(),n.send("active")}),this.send("sync",{scroll:n.scroll,settings:h.get()})}),this.loading.fail(function(e,t){"redirect"===e&&t&&n.previewUrl(t),"logged out"===e&&(n.preview&&(n.preview.destroy(),delete n.preview),n.login().done(n.refresh)),"cheatin"===e&&n.cheatin()})},login:function(){var e,t,n,i=this;return this._login||(e=u.Deferred(),this._login=e.promise(),t=new h.Messenger({channel:"login",url:h.settings.url.login}),n=u('<iframe src="'+h.settings.url.login+'" />').appendTo(this.container),t.targetWindow(n[0].contentWindow),t.bind("login",function(){n.remove(),t.destroy(),delete i._login,e.resolve()}),this._login)},cheatin:function(){u(document.body).empty().addClass("cheatin").append("<p>"+h.l10n.cheatin+"</p>")}}),h.controlConstructor={color:h.ColorControl,upload:h.UploadControl,image:h.ImageControl,header:h.HeaderControl,background:h.BackgroundControl},h.panelConstructor={},h.sectionConstructor={},u(function(){if(h.settings=window._wpCustomizeSettings,h.l10n=window._wpCustomizeControlsL10n,h.settings){if(!u.support.postMessage||!u.support.cors&&h.settings.isCrossDomain)return window.location=h.settings.url.fallback;var n,e,t,i,o,a,r=u(document.body),s=r.children(".wp-full-overlay"),c=u("#customize-info .theme-name.site-title"),l=u(".customize-controls-close"),d=u("#save");u("#customize-controls").on("keydown",function(e){var t=13===e.which,n=u(e.target);t&&(n.is("input:not([type=button])")||n.is("select"))&&e.preventDefault()}),u("#customize-info").find("> .accordion-section-title").on("click keydown",function(e){var t;h.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),e=(t=u(this).parent()).find(".accordion-section-content:first"),t.hasClass("cannot-expand")||(t.hasClass("open")?(t.toggleClass("open"),e.slideUp(h.Panel.prototype.defaultExpandedArguments.duration)):(e.slideDown(h.Panel.prototype.defaultExpandedArguments.duration),t.toggleClass("open"))))}),h.previewer=new h.Previewer({container:"#customize-preview",form:"#customize-controls",previewUrl:h.settings.url.preview,allowedUrls:h.settings.url.allowed,signature:"WP_CUSTOMIZER_SIGNATURE"},{nonce:h.settings.nonce,query:function(){var n={};return h.each(function(e,t){e._dirty&&(n[t]=e())}),{wp_customize:"on",theme:h.settings.theme.stylesheet,customized:JSON.stringify(n),nonce:this.nonce.preview}},save:function(){var e,t,n=this,i=u.extend(this.query(),{action:"customize_save",nonce:this.nonce.save}),o=h.state("processing");r.addClass("saving"),t=function(){var e=u.post(h.settings.url.ajax,i);h.trigger("save",e),e.always(function(){r.removeClass("saving")}),e.done(function(e){return"0"===e?(n.preview.iframe.hide(),void n.login().done(function(){n.save(),n.preview.iframe.show()})):void("-1"!==e?(h.each(function(e){e._dirty=!1}),h.trigger("saved")):n.cheatin())})},0===o()?t():(e=function(){0===o()&&(h.state.unbind("change",e),t())},h.state.bind("change",e))}}),u.ajaxPrefilter(function(e){/wp_customize=on/.test(e.data)&&(e.data+="&"+u.param({customize_preview_nonce:h.settings.nonce.preview}))}),h.previewer.bind("nonce",function(e){u.extend(this.nonce,e)}),u.each(h.settings.settings,function(e,t){h.create(e,e,t.value,{transport:t.transport,previewer:h.previewer})}),u.each(h.settings.panels,function(e,t){t=new(h.panelConstructor[t.type]||h.Panel)(e,{params:t});h.panel.add(e,t)}),u.each(h.settings.sections,function(e,t){t=new(h.sectionConstructor[t.type]||h.Section)(e,{params:t});h.section.add(e,t)}),u.each(h.settings.controls,function(e,t){t=new(h.controlConstructor[t.type]||h.Control)(e,{params:t,previewer:h.previewer});h.control.add(e,t)}),_.each(["panel","section","control"],function(e){var t,n=h.settings.autofocus[e];n&&h[e](n)&&(t=h[e](n)).deferred.embedded.done(function(){h.previewer.deferred.active.done(function(){t.focus()})})}),h.reflowPaneContents=_.bind(function(){var i,e,t,o=[],a=!1;document.activeElement&&(e=u(document.activeElement)),h.panel.each(function(e){var t=e.sections(),n=_.pluck(t,"container");o.push(e),i=e.container.find("ul:first"),h.utils.areElementListsEqual(n,i.children("[id]"))||(_(t).each(function(e){i.append(e.container)}),a=!0)}),h.section.each(function(e){var t=e.controls(),n=_.pluck(t,"container");e.panel()||o.push(e),i=e.container.find("ul:first"),h.utils.areElementListsEqual(n,i.children("[id]"))||(_(t).each(function(e){i.append(e.container)}),a=!0)}),o.sort(h.utils.prioritySort),t=_.pluck(o,"container"),i=u("#customize-theme-controls").children("ul"),h.utils.areElementListsEqual(t,i.children())||(_(o).each(function(e){i.append(e.container)}),a=!0),h.panel.each(function(e){var t=e.active();e.active.callbacks.fireWith(e.active,[t,t])}),h.section.each(function(e){var t=e.active();e.active.callbacks.fireWith(e.active,[t,t])}),a&&e&&e.focus()},h),h.bind("ready",h.reflowPaneContents),h.reflowPaneContents=_.debounce(h.reflowPaneContents,100),u([h.panel,h.section,h.control]).each(function(e,t){t.bind("add",h.reflowPaneContents),t.bind("change",h.reflowPaneContents),t.bind("remove",h.reflowPaneContents)}),h.previewer.previewUrl()?h.previewer.refresh():h.previewer.previewUrl(h.settings.url.home),t=new h.Values,i=t.create("saved"),o=t.create("activated"),a=t.create("processing"),t.bind("change",function(){o()?i()?(d.val(h.l10n.saved).prop("disabled",!0),l.find(".screen-reader-text").text(h.l10n.close)):(d.val(h.l10n.save).prop("disabled",!1),l.find(".screen-reader-text").text(h.l10n.cancel)):(d.val(h.l10n.activate).prop("disabled",!1),l.find(".screen-reader-text").text(h.l10n.cancel))}),i(!0),o(h.settings.theme.active),a(0),h.bind("change",function(){t("saved").set(!1)}),h.bind("saved",function(){t("saved").set(!0),t("activated").set(!0)}),o.bind(function(e){e&&h.trigger("activated")}),h.state=t,d.click(function(e){h.previewer.save(),e.preventDefault()}).keydown(function(e){9!==e.which&&(13===e.which&&h.previewer.save(),e.preventDefault())}),u("#customize-header-actions").on("click keydown",".control-panel-back",function(e){h.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),h.panel.each(function(e){e.collapse()}))}),l.keydown(function(e){9!==e.which&&(13===e.which&&this.click(),e.preventDefault())}),u(".collapse-sidebar").on("click keydown",function(e){h.utils.isKeydownButNotEnterEvent(e)||(s.toggleClass("collapsed").toggleClass("expanded"),e.preventDefault())}),c.length&&u("#customize-control-blogname input").on("input",function(){c.text(this.value)}),(n=new h.Messenger({url:h.settings.url.parent,channel:"loader"})).bind("back",function(){l.on("click.customize-controls-close",function(e){e.preventDefault(),n.send("close")})}),u(window).on("beforeunload",function(){if(!h.state("saved")())return h.l10n.saveAlert}),u.each(["saved","change"],function(e,t){h.bind(t,function(){n.send(t)})}),h.bind("activated",function(){n.targetWindow()?n.send("activated",h.settings.url.activated):h.settings.url.activated&&(window.location=h.settings.url.activated)}),n.send("ready"),u.each({background_image:{controls:["background_repeat","background_position_x","background_attachment"],callback:function(e){return!!e}},show_on_front:{controls:["page_on_front","page_for_posts"],callback:function(e){return"page"===e}},header_textcolor:{controls:["header_textcolor"],callback:function(e){return"blank"!==e}}},function(e,i){h(e,function(n){u.each(i.controls,function(e,t){h.control(t,function(t){function e(e){t.container.toggle(i.callback(e))}e(n.get()),n.bind(e)})})})}),h.control("display_header_text",function(t){var n="";t.elements[0].unsync(h("header_textcolor")),t.element=new h.Element(t.container.find("input")),t.element.set("blank"!==t.setting()),t.element.bind(function(e){e||(n=h("header_textcolor").get()),t.setting.set(e?n:"blank")}),t.setting.bind(function(e){t.element.set("blank"!==e)})}),h.trigger("ready"),(e=l).focus(),setTimeout(function(){e.focus()},200)}})}((wp,jQuery));